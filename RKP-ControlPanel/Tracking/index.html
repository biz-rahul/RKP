<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ControlTheWorld - Repo Viewer</title>

<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-markup.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-css.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>

<style>
body {
    margin: 0;
    font-family: "Segoe UI", sans-serif;
    background: #0f172a;
    color: white;
    display: flex;
    height: 100vh;
}

.sidebar {
    width: 320px;
    background: #1e293b;
    overflow-y: auto;
    padding: 20px;
    border-right: 1px solid #334155;
}

.content {
    flex: 1;
    padding: 25px;
    overflow-y: auto;
}

h1 {
    font-size: 18px;
    margin-top: 0;
    color: #60a5fa;
}

.file, .folder {
    padding: 8px 12px;
    margin: 4px 0;
    border-radius: 6px;
    cursor: pointer;
    transition: 0.2s;
    font-size: 14px;
}

.file:hover, .folder:hover {
    background: #334155;
}

.folder::before { content: "ðŸ“‚ "; }
.file::before { content: "ðŸ“„ "; }

.breadcrumb {
    color: #94a3b8;
    margin-bottom: 12px;
    font-size: 14px;
}

pre {
    background: #1e293b;
    padding: 15px;
    border-radius: 8px;
    overflow-x: auto;
}

button {
    padding: 8px 12px;
    border-radius: 6px;
    border: none;
    cursor: pointer;
    margin-bottom: 10px;
}

.copy-btn {
    background: #10b981;
    color: white;
}

.copy-btn:hover {
    background: #059669;
}

.loading {
    color: #facc15;
    font-size: 14px;
}
</style>
</head>

<body>

<div class="sidebar">
    <h1>ControlTheWorld</h1>
    <div id="fileList"></div>
</div>

<div class="content">
    <div class="breadcrumb" id="breadcrumb"></div>
    <button class="copy-btn" id="copyBtn" style="display:none;">Copy Code</button>
    <div id="loading" class="loading"></div>
    <pre><code id="fileContent"></code></pre>
</div>

<script>
const owner = "MOFO-UG";
const repo = "ControlTheWorld";

let currentPath = "";
let defaultBranch = "";
let currentContent = "";

async function init() {
    // Detect default branch automatically
    const repoInfo = await fetch(`https://api.github.com/repos/${owner}/${repo}`);
    const repoData = await repoInfo.json();
    defaultBranch = repoData.default_branch;

    loadContents("");
}

async function loadContents(path) {
    currentPath = path;
    document.getElementById("breadcrumb").innerText = "/" + path;
    document.getElementById("loading").innerText = "Loading...";
    document.getElementById("fileContent").textContent = "";
    document.getElementById("copyBtn").style.display = "none";

    const response = await fetch(
        `https://api.github.com/repos/${owner}/${repo}/contents/${path}?ref=${defaultBranch}`
    );

    if (!response.ok) {
        document.getElementById("loading").innerText = "Failed to load.";
        return;
    }

    const data = await response.json();
    const fileList = document.getElementById("fileList");
    fileList.innerHTML = "";
    document.getElementById("loading").innerText = "";

    if (path !== "") {
        const up = document.createElement("div");
        up.className = "folder";
        up.innerText = ".. (Back)";
        up.onclick = () => {
            const parts = path.split("/");
            parts.pop();
            loadContents(parts.join("/"));
        };
        fileList.appendChild(up);
    }

    data.forEach(item => {
        const div = document.createElement("div");
        div.className = item.type === "dir" ? "folder" : "file";
        div.innerText = item.name;

        if (item.type === "dir") {
            div.onclick = () => loadContents(item.path);
        } else {
            div.onclick = () => loadFile(item.path, item.name);
        }

        fileList.appendChild(div);
    });
}

async function loadFile(path, filename) {
    document.getElementById("loading").innerText = "Loading file...";
    const rawUrl = `https://raw.githubusercontent.com/${owner}/${repo}/${defaultBranch}/${path}`;

    const response = await fetch(rawUrl);
    const text = await response.text();
    currentContent = text;

    const codeBlock = document.getElementById("fileContent");
    let language = "javascript";

    if (filename.endsWith(".json")) language = "json";
    else if (filename.endsWith(".html")) language = "markup";
    else if (filename.endsWith(".css")) language = "css";
    else if (filename.endsWith(".txt")) language = "none";

    codeBlock.className = "language-" + language;
    codeBlock.textContent = text;
    Prism.highlightElement(codeBlock);

    document.getElementById("copyBtn").style.display = "inline-block";
    document.getElementById("loading").innerText = "";
}

document.getElementById("copyBtn").addEventListener("click", () => {
    navigator.clipboard.writeText(currentContent);
    alert("Copied successfully.");
});

init();
</script>

</body>
</html>
