<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Apps Analytics Viewer</title><style>

/* ================= GLOBAL ================= */

*{
box-sizing:border-box;
}

body{
margin:0;
font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
background:#e6edf5;
color:#2d3748;
}

/* ================= HEADER ================= */

.header{
text-align:center;
padding:25px 10px;
font-size:26px;
font-weight:700;
}

/* ================= NEUMORPHIC ================= */

.neu-card{
background:#e6edf5;
border-radius:20px;
box-shadow:
8px 8px 16px #c5ccd3,
-8px -8px 16px #ffffff;
}

.neu-inset{
background:#e6edf5;
border-radius:15px;
box-shadow:
inset 4px 4px 8px #c5ccd3,
inset -4px -4px 8px #ffffff;
}

.neu-button{
border:none;
padding:12px 20px;
border-radius:12px;
background:#e6edf5;
box-shadow:
4px 4px 8px #c5ccd3,
-4px -4px 8px #ffffff;
font-weight:600;
cursor:pointer;
margin-top:10px;
}

.neu-button:active{
box-shadow:
inset 4px 4px 8px #c5ccd3,
inset -4px -4px 8px #ffffff;
}

/* ================= INPUT PANEL ================= */

#inputPanel{
margin:15px;
padding:20px;
}

.label{
font-weight:600;
margin-top:15px;
margin-bottom:8px;
}

input, textarea{
width:100%;
padding:15px;
border:none;
outline:none;
font-size:16px;
}

textarea{
height:120px;
resize:none;
}

/* ================= VIEWER ================= */

#viewer{
display:none;
padding:10px;
}

.file-card{
margin:10px;
padding:15px;
}

.file-row{
display:flex;
justify-content:space-between;
align-items:center;
padding:12px;
margin:6px 0;
border-radius:12px;
cursor:pointer;
}

.file-row:hover{
transform:scale(1.01);
}

.folder{
color:#2563eb;
font-weight:600;
}

.file{
color:#059669;
}

.hidden{
color:#64748b;
}

.path{
font-size:11px;
color:#64748b;
}

/* ================= BACK BUTTON ================= */

.back-button{
font-weight:700;
color:#7c3aed;
}

/* ================= MOBILE ================= */

@media(max-width:600px){

.header{
font-size:22px;
}

}

</style></head>
<body>
<!-- HEADER -->

<div class="header">
Apps Analytics Viewer
</div>

<!-- INPUT PANEL -->

<div id="inputPanel" class="neu-card">

<div>Load from Link</div>

<input type="text"
id="linkInput"
class="neu-inset"
value="https://raw.githubusercontent.com/MOFO-UG/ControlTheWorld/main/SM-E156B/Example/18-02-2026/example.json">

<button class="neu-button" onclick="loadFromLink()">Load</button>

<div>Paste JSON</div>

<textarea id="pasteInput" class="neu-inset"></textarea>

<button class="neu-button" onclick="loadFromPaste()">Load</button>

<div>Select File</div>

<input type="file" id="fileInput" class="neu-inset">

</div>

<!-- EXPLORER -->

<div id="explorerContainer">

<!-- TOOLBAR -->

<div id="toolbar" class="neu-card">

<img src="icons/back.png" id="backBtn" width="30">

<img src="icons/forward.png" id="forwardBtn" width="30">

<input type="text"
id="searchInput"
class="neu-inset"
placeholder="Search entire storage">

<button id="searchBtn" class="neu-button">Search</button>

<select id="viewMode" class="neu-inset">
<option value="list">List</option>
<option value="grid">Grid</option>
<option value="compact">Compact</option>
</select>

<label>
<input type="checkbox" id="hiddenToggle">
Show Hidden
</label>

<button id="visualBtn" class="neu-button">Visualization</button>

<button id="largestBtn" class="neu-button">Top 100 Largest</button>

<button id="duplicateBtn" class="neu-button">Duplicates</button>

<button id="statsBtn" class="neu-button">Extension Stats</button>

</div>

<!-- BREADCRUMB -->

<div id="breadcrumbBar" class="neu-card"></div>

<!-- FILTER BAR -->

<div id="filterBar" class="neu-card">

<select id="timeFilter" class="neu-inset">
<option value="">All Time</option>
<option value="24h">Last 24 Hours</option>
<option value="7d">Last 7 Days</option>
<option value="1m">Last 1 Month</option>
<option value="1y">Last 1 Year</option>
<option value="older">Older than 1 Year</option>
<option value="custom">Custom</option>
</select>

<input type="date" id="dateFrom" class="neu-inset">

<input type="date" id="dateTo" class="neu-inset">

<select id="sizeFilter" class="neu-inset">
<option value="">All Sizes</option>
<option value="1gb">Greater than 1GB</option>
<option value="500mb">Greater than 500MB</option>
<option value="custom">Custom</option>
</select>

<input type="number" id="sizeMin" class="neu-inset" placeholder="Min bytes">

<input type="number" id="sizeMax" class="neu-inset" placeholder="Max bytes">

<select id="typeFilter" class="neu-inset">
<option value="">All Types</option>
<option value="pdf">PDF</option>
<option value="jpg">Image</option>
<option value="png">Image</option>
<option value="mp4">Video</option>
<option value="apk">APK</option>
<option value="zip">ZIP</option>
<option value="mp3">Audio</option>
<option value="json">JSON</option>
<option value="txt">Text</option>
</select>

</div>

<!-- FILE VIEWER -->

<div id="viewer" class="neu-card"></div>

<!-- PANELS -->

<div id="detailsPanel" class="neu-card"></div>

<div id="visualPanel" class="neu-card"></div>

<div id="statsPanel" class="neu-card"></div>

</div>
    
<script>

/* ================= STATE ================= */

let fileIndex = {};
let childrenMap = {};
let currentPath = "/storage/emulated/0";

let historyStack = [];
let historyIndex = -1;

let showHidden = false;

let currentFilter = {
type:null,
sizeMin:null,
sizeMax:null,
time:null
};


/* ================= FILE INPUT ================= */

document.getElementById("fileInput").addEventListener("change", function(){

const file = this.files[0];

if(!file) return;

const reader = new FileReader();

reader.onload = e => processJSON(e.target.result);

reader.readAsText(file);

});


/* ================= LOAD METHODS ================= */

function loadFromLink(){

fetch(document.getElementById("linkInput").value)
.then(r=>r.text())
.then(processJSON)
.catch(()=>alert("Load failed"));

}

function loadFromPaste(){

processJSON(document.getElementById("pasteInput").value);

}


/* ================= PROCESS JSON ================= */

function processJSON(text){

let data;

try{
data = JSON.parse(text);
}catch{
alert("Invalid JSON");
return;
}

buildFileSystem(data);

document.getElementById("inputPanel").style.display="none";

document.getElementById("explorerContainer").style.display="block";

if(!childrenMap[currentPath])
currentPath="/";

renderDirectory(currentPath);

buildStats();

}


/* ================= BUILD FILESYSTEM ================= */

function buildFileSystem(data){

fileIndex = {};
childrenMap = {};

data.forEach(item=>{

item.directory = item.is_directory;
item.hidden = item.is_hidden;
item.last_modified = item.modified || 0;

fileIndex[item.path] = item;

let parts = item.path.split("/").filter(Boolean);

for(let i=0;i<parts.length;i++){

let parent = "/" + parts.slice(0,i).join("/");
let child = "/" + parts.slice(0,i+1).join("/");

if(parent==="") parent="/";

if(!childrenMap[parent])
childrenMap[parent]=[];

let existing=fileIndex[child];

if(existing && !childrenMap[parent].some(x=>x.path===child)){

childrenMap[parent].push(existing);

}

}

});

}


/* ================= FOLDER SIZE ================= */

function calculateFolderSize(path){

let total=0;

let stack=[path];

while(stack.length){

let current=stack.pop();

(childrenMap[current]||[]).forEach(item=>{

if(item.directory)
stack.push(item.path);
else
total+=item.size||0;

});

}

return total;

}


/* ================= HISTORY ================= */

function pushHistory(path){

historyStack=historyStack.slice(0,historyIndex+1);

historyStack.push(path);

historyIndex++;

}

document.getElementById("backBtn").onclick=function(){

if(historyIndex>0){

historyIndex--;

renderDirectory(historyStack[historyIndex],false);

}

};

document.getElementById("forwardBtn").onclick=function(){

if(historyIndex<historyStack.length-1){

historyIndex++;

renderDirectory(historyStack[historyIndex],false);

}

};


/* ================= BREADCRUMB ================= */

function renderBreadcrumb(path){

const bar=document.getElementById("breadcrumbBar");

bar.innerHTML="";

let parts=path.split("/").filter(Boolean);

let current="";

let root=document.createElement("span");

root.innerText="/";

root.onclick=()=>renderDirectory("/");

root.style.cursor="pointer";

bar.appendChild(root);

parts.forEach(part=>{

current+="/"+part;

bar.innerHTML+=" / ";

let btn=document.createElement("span");

btn.innerText=part;

btn.style.cursor="pointer";

btn.onclick=()=>renderDirectory(current);

bar.appendChild(btn);

});

}


/* ================= FILTER ================= */

function applyFilters(list){

return list.filter(item=>{

if(!showHidden && item.hidden)
return false;

if(currentFilter.type){

if(!item.name.toLowerCase().endsWith(currentFilter.type))
return false;

}

if(currentFilter.sizeMin!=null){

let size=item.directory?
calculateFolderSize(item.path):item.size;

if(size<currentFilter.sizeMin)
return false;

}

if(currentFilter.sizeMax!=null){

let size=item.directory?
calculateFolderSize(item.path):item.size;

if(size>currentFilter.sizeMax)
return false;

}

return true;

});

}


/* ================= RENDER ================= */

function renderDirectory(path,addHistory=true){

currentPath=path;

if(addHistory)
pushHistory(path);

renderBreadcrumb(path);

const viewer=document.getElementById("viewer");

viewer.innerHTML="";

let list=childrenMap[path]||[];

list=applyFilters(list);

list.sort((a,b)=>{

if(a.directory && !b.directory) return -1;
if(!a.directory && b.directory) return 1;

return a.name.localeCompare(b.name);

});

if(path!="/"){

let back=document.createElement("div");

back.className="file-row";

back.innerHTML="....";

back.onclick=()=>{

let parent=getParent(path);

if(parent) renderDirectory(parent);

};

viewer.appendChild(back);

}

list.forEach(item=>{

let row=document.createElement("div");

row.className="file-row";

row.innerHTML=`

<div>
${item.directory?'üìÅ':'üìÑ'} ${item.name}
</div>

<div>
${formatSize(item.directory?
calculateFolderSize(item.path):
item.size)}
</div>

`;

row.onclick=()=>{

if(item.directory)
renderDirectory(item.path);
else
showDetails(item);

};

viewer.appendChild(row);

});

}


/* ================= GET PARENT ================= */

function getParent(path){

if(path=="/") return null;

let parts=path.split("/").filter(Boolean);

parts.pop();

return parts.length?"/"+parts.join("/"):"/";

}


/* ================= SIZE FORMAT ================= */

function formatSize(size){

if(size>1e9) return (size/1e9).toFixed(2)+" GB";
if(size>1e6) return (size/1e6).toFixed(2)+" MB";
if(size>1e3) return (size/1e3).toFixed(2)+" KB";

return size+" B";

}


/* ================= SEARCH ================= */

document.getElementById("searchBtn").onclick=function(){

let query=document.getElementById("searchInput").value.toLowerCase();

let results=Object.values(fileIndex)
.filter(item=>item.name.toLowerCase().includes(query));

showResults(results);

};

function showResults(results){

const viewer=document.getElementById("viewer");

viewer.innerHTML="";

results.forEach(item=>{

let row=document.createElement("div");

row.className="file-row";

row.innerHTML=item.name;

row.onclick=()=>{

if(item.directory)
renderDirectory(item.path);
else
showDetails(item);

};

viewer.appendChild(row);

});

}


/* ================= DETAILS ================= */

function showDetails(item){

const panel=document.getElementById("detailsPanel");

panel.style.display="block";

panel.innerHTML=`

<h3>${item.name}</h3>

Path: ${item.path}<br>

Size: ${formatSize(item.directory?
calculateFolderSize(item.path):
item.size)}<br>

Modified: ${new Date(item.last_modified)}<br>

<button onclick="navigator.clipboard.writeText('${item.path}')">
Copy Path
</button>

`;

}


/* ================= LARGEST FILES ================= */

document.getElementById("largestBtn").onclick=function(){

let files=Object.values(fileIndex)
.filter(x=>!x.directory)
.sort((a,b)=>b.size-a.size)
.slice(0,100);

showResults(files);

};


/* ================= DUPLICATES ================= */

document.getElementById("duplicateBtn").onclick=function(){

let map={};

Object.values(fileIndex).forEach(file=>{

if(file.directory) return;

let key=file.size+"_"+file.name;

if(!map[key]) map[key]=[];

map[key].push(file);

});

let dup=[];

Object.values(map).forEach(list=>{

if(list.length>1)
dup.push(...list);

});

showResults(dup);

};


/* ================= HIDDEN TOGGLE ================= */

document.getElementById("hiddenToggle").onchange=function(){

showHidden=this.checked;

renderDirectory(currentPath);

};


/* ================= TYPE FILTER ================= */

document.getElementById("typeFilter").onchange=function(){

currentFilter.type=this.value||null;

renderDirectory(currentPath);

};


/* ================= SIZE FILTER ================= */

document.getElementById("sizeFilter").onchange=function(){

if(this.value=="1gb")
currentFilter.sizeMin=1e9;

else if(this.value=="500mb")
currentFilter.sizeMin=5e8;

else
currentFilter.sizeMin=null;

renderDirectory(currentPath);

};


/* ================= STATS ================= */

document.getElementById("statsBtn").onclick=function(){

let stats={};

Object.values(fileIndex).forEach(file=>{

if(file.directory) return;

let ext=file.name.split(".").pop();

stats[ext]=(stats[ext]||0)+1;

});

let html="<h3>Extension Statistics</h3>";

Object.entries(stats).forEach(([ext,count])=>{

html+=ext+": "+count+"<br>";

});

let panel=document.getElementById("statsPanel");

panel.innerHTML=html;

panel.style.display="block";

};


</script>

    </body>
</html>
