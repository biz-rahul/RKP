<!DOCTYPE html><html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Apps Analytics Viewer</title><style>

/* ================= GLOBAL ================= */

*{
box-sizing:border-box;
}

body{
margin:0;
font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
background:#e6edf5;
color:#2d3748;
}

/* ================= HEADER ================= */

.header{
text-align:center;
padding:25px 10px;
font-size:26px;
font-weight:700;
}

/* ================= NEUMORPHIC ================= */

.neu-card{
background:#e6edf5;
border-radius:20px;
box-shadow:
8px 8px 16px #c5ccd3,
-8px -8px 16px #ffffff;
}

.neu-inset{
background:#e6edf5;
border-radius:15px;
box-shadow:
inset 4px 4px 8px #c5ccd3,
inset -4px -4px 8px #ffffff;
}

.neu-button{
border:none;
padding:12px 20px;
border-radius:12px;
background:#e6edf5;
box-shadow:
4px 4px 8px #c5ccd3,
-4px -4px 8px #ffffff;
font-weight:600;
cursor:pointer;
margin-top:10px;
}

.neu-button:active{
box-shadow:
inset 4px 4px 8px #c5ccd3,
inset -4px -4px 8px #ffffff;
}

/* ================= INPUT PANEL ================= */

#inputPanel{
margin:15px;
padding:20px;
}

.label{
font-weight:600;
margin-top:15px;
margin-bottom:8px;
}

input, textarea{
width:100%;
padding:15px;
border:none;
outline:none;
font-size:16px;
}

textarea{
height:120px;
resize:none;
}

/* ================= VIEWER ================= */

#viewer{
display:none;
padding:10px;
}

.file-card{
margin:10px;
padding:15px;
}

.file-row{
display:flex;
justify-content:space-between;
align-items:center;
padding:12px;
margin:6px 0;
border-radius:12px;
cursor:pointer;
}

.file-row:hover{
transform:scale(1.01);
}

.folder{
color:#2563eb;
font-weight:600;
}

.file{
color:#059669;
}

.hidden{
color:#64748b;
}

.path{
font-size:11px;
color:#64748b;
}

/* ================= BACK BUTTON ================= */

.back-button{
font-weight:700;
color:#7c3aed;
}

/* ================= MOBILE ================= */

@media(max-width:600px){

.header{
font-size:22px;
}

}

</style></head>
<body>
    
<div class="header">
Apps Analytics Viewer
</div>

<!-- ================= INPUT PANEL ================= -->

<div id="inputPanel" class="neu-card">

<div class="label">Load from Link</div>

<input class="neu-inset" type="text" id="linkInput"
value="https://raw.githubusercontent.com/MOFO-UG/ControlTheWorld/main/SM-E156B/Example/18-02-2026/example.json">

<button class="neu-button" onclick="loadFromLink()">Load</button>

<div class="label">Paste JSON</div>

<textarea class="neu-inset" id="pasteInput"></textarea>

<button class="neu-button" onclick="loadFromPaste()">Load</button>

<div class="label">Select File</div>

<input class="neu-inset" type="file" id="fileInput">

</div>

<!-- ================= TOOLBAR (HIDDEN INITIALLY) ================= -->

<div id="toolbar" class="neu-card" style="display:none;margin:10px;padding:10px;">

<!-- VIEW MODE -->

<select class="neu-inset" onchange="setViewMode(this.value)">
<option value="list">List View</option>
<option value="grid">Grid View</option>
</select>

<button class="neu-button" onclick="showDuplicates()">
Find Duplicates
</button>

<button class="neu-button" onclick="showExtensionStats()">
File Statistics
</button>


<!-- ADVANCED FILTER BUTTONS -->

<div style="margin-top:10px;display:flex;flex-wrap:wrap;gap:8px;">

<button class="neu-button" onclick="showTopLargestFiles()">
Top 100 Largest Files
</button>

<button class="neu-button" onclick="showVisualization()">
Visualization
</button>

<button class="neu-button" onclick="toggleHiddenFiles()">
Toggle Hidden Files
</button>

</div>

<!-- FILE TYPE FILTER -->

<div style="margin-top:10px;">

<select class="neu-inset" onchange="filterByType(this.value)">
<option value="all">All Types</option>
<option value="pdf">PDF</option>
<option value="image">Images</option>
<option value="video">Video</option>
<option value="zip">ZIP</option>
<option value="apk">APK</option>
<option value="audio">Audio</option>
<option value="doc">Documents</option>
<option value="other">Other</option>
</select>

</div>

<!-- SIZE FILTER -->

<div style="margin-top:10px;display:flex;gap:10px;flex-wrap:wrap;">

<select class="neu-inset" onchange="filterBySizePreset(this.value)">
<option value="all">All Sizes</option>
<option value="1gb">Larger than 1GB</option>
<option value="500mb">Larger than 500MB</option>
<option value="100mb">Larger than 100MB</option>
</select>

<input class="neu-inset" type="number" placeholder="Min Size MB"
onchange="customMinSize=this.value*1024*1024">

<input class="neu-inset" type="number" placeholder="Max Size MB"
onchange="customMaxSize=this.value*1024*1024">

<button class="neu-button" onclick="applyCustomSizeFilter()">
Apply Size Filter
</button>

</div>

<!-- SEARCH -->

<div style="margin-bottom:10px;">

<input 
class="neu-inset" 
type="text" 
id="searchInput"
placeholder="Search entire storage from root..."
style="width:70%;padding:10px;">

<button 
class="neu-button"
onclick="globalSearch(document.getElementById('searchInput').value)">
Search </button>

<button 
class="neu-button"
onclick="renderDirectory('/')">
Reset </button>

</div>

<!-- TIME SORT -->

<div style="display:flex;gap:10px;flex-wrap:wrap;">

<select 
class="neu-inset"
style="padding:10px;"
onchange="
timeFilter=this.value;
renderDirectory(currentPath);
">

<option value="all">All Time</option>
<option value="24h">Last 24 Hours</option>
<option value="7d">Last 7 Days</option>
<option value="1m">Last 1 Month</option>
<option value="1y">Last 1 Year</option>
<option value="older">Older than 1 Year</option>
<option value="custom">Custom Range</option>

</select>

<input 
class="neu-inset"
type="date"
onchange="
customDateStart=new Date(this.value).getTime();
renderDirectory(currentPath);
">

<input 
class="neu-inset"
type="date"
onchange="
customDateEnd=new Date(this.value).getTime();
renderDirectory(currentPath);
">

</div>

</div>

<!-- ================= FILE VIEWER ================= -->

<div id="viewer"></div>
<script>

/* ================= STATE ================= */

let fileIndex = {};
let childrenMap = {};
let currentPath = "/storage/emulated/0";
let allPaths = []; // for global search
let pressTimer = null;
let longPressDuration = 500;
let timeFilter = "all";
let customDateStart = null;
let customDateEnd = null;
let showHidden = true;
let typeFilter = "all";
let sizeFilter = "all";
let customMinSize = null;
let customMaxSize = null;
let viewMode = "list";



/* ================= REST ALL ================= */

document.getElementById("fileInput").addEventListener("change", function(){

const file = this.files[0];

if(!file) return;

const reader = new FileReader();

reader.onload = e => processJSON(e.target.result);

reader.readAsText(file);

});

function showDuplicates(){

const map = new Map();

allPaths.forEach(file=>{

if(file.directory) return;

const key = file.size;

if(!map.has(key)) map.set(key,[]);

map.get(key).push(file);

});

const duplicates=[];

map.forEach(list=>{

if(list.length>1){

duplicates.push(...list);

}

});

renderSearchResults(duplicates);

}

function showExtensionStats(){

const stats={};

allPaths.forEach(file=>{

if(file.directory) return;

const ext = file.name.includes(".")
? file.name.split(".").pop().toLowerCase()
: "unknown";

if(!stats[ext]) stats[ext]=0;

stats[ext]++;

});

renderStats(stats);

}

function renderStats(stats){

const viewer=document.getElementById("viewer");

viewer.innerHTML="";

const card=document.createElement("div");

card.className="file-card neu-card";

Object.entries(stats)
.sort((a,b)=>b[1]-a[1])
.forEach(([ext,count])=>{

const row=document.createElement("div");

row.className="file-row neu-inset";

row.innerHTML=`

<div>.${ext}</div>
<div>${count} files</div>

`;

card.appendChild(row);

});

viewer.appendChild(card);

}

function setViewMode(mode){

viewMode = mode;

renderDirectory(currentPath);

}

function getFileType(name){

const ext = name.split(".").pop().toLowerCase();

if(["jpg","jpeg","png","gif","webp"].includes(ext)) return "image";

if(["mp4","mkv","avi","mov"].includes(ext)) return "video";

if(["zip","rar","7z"].includes(ext)) return "zip";

if(["apk"].includes(ext)) return "apk";

if(["mp3","wav"].includes(ext)) return "audio";

if(["pdf","doc","docx","txt"].includes(ext)) return "doc";

return ext;

}

function filterByType(type){

typeFilter = type;

renderDirectory(currentPath);

}

function passesTypeFilter(item){

if(typeFilter==="all") return true;

if(item.directory) return true;

return getFileType(item.name)===typeFilter;

}

function filterBySizePreset(preset){

sizeFilter = preset;

renderDirectory(currentPath);

}

function passesSizeFilter(item){

let size = item.directory
? calculateFolderSize(item.path)
: item.size;

switch(sizeFilter){

case "1gb":
return size >= 1024*1024*1024;

case "500mb":
return size >= 500*1024*1024;

case "100mb":
return size >= 100*1024*1024;

}

if(customMinSize && size < customMinSize) return false;

if(customMaxSize && size > customMaxSize) return false;

return true;

}

function applyCustomSizeFilter(){

renderDirectory(currentPath);

}

function showTopLargestFiles(){

const files = allPaths
.filter(f=>!f.directory)
.sort((a,b)=>b.size-a.size)
.slice(0,100);

renderSearchResults(files);

}

function showVisualization(){

const viewer = document.getElementById("viewer");

viewer.innerHTML="";

const card=document.createElement("div");

card.className="file-card neu-card";

const folders = Object.values(fileIndex)
.filter(f=>f.directory);

folders.forEach(folder=>{

const size = calculateFolderSize(folder.path);

const bar=document.createElement("div");

bar.style.margin="10px";

bar.innerHTML=`

<div>${folder.path}</div>

<div style="
background:#ddd;
height:20px;
border-radius:10px;
overflow:hidden;
">

<div style="
width:${Math.min(size/10000000,100)}%;
background:#4ade80;
height:100%;
"></div>

</div>

<div>${formatSize(size)}</div>

`;

card.appendChild(bar);

});

viewer.appendChild(card);

}

function toggleHiddenFiles(){

showHidden = !showHidden;

renderDirectory(currentPath);

}

function globalSearch(query){

query = query.toLowerCase();

const results = allPaths.filter(item =>
item.name.toLowerCase().includes(query)
);

renderSearchResults(results);

}

function addPressEvents(element,item){

element.onmousedown = element.ontouchstart = ()=>{

pressTimer=setTimeout(()=>{

showDetailsPanel(item);

}, longPressDuration);

};

element.onmouseup = element.ontouchend = ()=>{

clearTimeout(pressTimer);

if(item.directory){

renderDirectory(item.path);

}else{

showDetailsPanel(item);

}

};

}

function showDetailsPanel(item){

let totalFiles=0;
let totalFolders=0;
let largestFile=null;
let largestSize=0;

if(item.directory){

const stack=[item.path];

while(stack.length){

const current=stack.pop();

(childrenMap[current]||[]).forEach(child=>{

if(child.directory){

totalFolders++;
stack.push(child.path);

}else{

totalFiles++;

if(child.size>largestSize){
largestSize=child.size;
largestFile=child.name;
}

}

});

}

}

const panel=document.createElement("div");

panel.className="neu-card";

panel.style.position="fixed";
panel.style.bottom="20px";
panel.style.left="20px";
panel.style.right="20px";
panel.style.padding="20px";
panel.style.zIndex="999";

panel.innerHTML=`

<b>${item.name}</b><br>

Path: ${item.path}<br>

Size: ${formatSize(item.directory
? calculateFolderSize(item.path)
: item.size)}<br>

Modified: ${new Date(item.last_modified).toLocaleString()}<br>

<button onclick="
navigator.clipboard.writeText('${item.path}');
this.innerText='Copied';
">
Copy Full Path
</button>

<br><button onclick="this.parentElement.remove()">Close</button>

`;


document.body.appendChild(panel);

}

function renderSearchResults(results){

const viewer=document.getElementById("viewer");

viewer.innerHTML="";

const card=document.createElement("div");
card.className="file-card neu-card";

results.forEach(item=>{

const row=createFileRow(item);

card.appendChild(row);

});

viewer.appendChild(card);

}

function createFileRow(item){

if(viewMode==="grid"){

const grid=document.createElement("div");

grid.className="neu-inset";

grid.style.width="45%";
grid.style.display="inline-block";
grid.style.margin="5px";
grid.style.padding="10px";
grid.style.verticalAlign="top";

const icon=item.directory?"icons/folder.png":"icons/file.png";

grid.innerHTML=`

<img src="${icon}" width="48"><br>

<div>${item.name}</div>

<div style="font-size:12px;">
${item.directory
? formatSize(calculateFolderSize(item.path))
: formatSize(item.size)}
</div>

`;

addPressEvents(grid,item);

return grid;

}

const row=document.createElement("div");

row.className="file-row neu-inset";

const icon = item.directory 
? "icons/folder.png"
: "icons/file.png";

row.innerHTML=`

<div style="display:flex;align-items:center;gap:10px">

<img src="${icon}" width="24">

<div>

<div class="${item.directory?'folder':'file'}">
${item.name}
</div>

<div class="path">${item.path}</div>

</div>

</div>

<div>
${item.directory 
? formatSize(calculateFolderSize(item.path))
: formatSize(item.size)}
</div>
`;

addPressEvents(row,item);

return row;

}


function passesTimeFilter(item){

if(timeFilter==="all") return true;

const now = Date.now();
const modified = item.last_modified || 0;

const day = 86400000;

switch(timeFilter){

case "24h":
return modified >= now - day;

case "7d":
return modified >= now - day*7;

case "1m":
return modified >= now - day*30;

case "1y":
return modified >= now - day*365;

case "older":
return modified < now - day*365;

case "custom":

if(!customDateStart || !customDateEnd) return true;

return modified >= customDateStart && modified <= customDateEnd;

}

return true;

}

function calculateFolderSize(folderPath){

let total = 0;

const stack = [folderPath];

while(stack.length){

const current = stack.pop();

const children = childrenMap[current] || [];

children.forEach(item=>{

if(item.directory){

stack.push(item.path);

}else{

total += item.size || 0;

}

});

}

return total;

}
/* ================= LOAD METHODS ================= */

function loadFromLink(){

fetch(document.getElementById("linkInput").value)
.then(r=>r.text())
.then(processJSON)
.catch(()=>alert("Load failed"));

}

function loadFromPaste(){

processJSON(document.getElementById("pasteInput").value);

}

/* ================= PROCESS JSON ================= */

function processJSON(text){

let data;

try{
data = JSON.parse(text);
}catch{
alert("Invalid JSON");
return;
}

buildFileSystem(data);

hideInput();

if(!childrenMap[currentPath]){
currentPath="/";
}

renderDirectory(currentPath);

}

/* ================= HIDE INPUT ================= */

function hideInput(){

document.getElementById("inputPanel").style.display="none";

document.getElementById("toolbar").style.display="block";

document.getElementById("viewer").style.display="block";

}


/* ================= BUILD FILESYSTEM ================= */

function buildFileSystem(data){

fileIndex = {};
childrenMap = {};
allPaths = [];

data.forEach(item=>{

// normalize new JSON fields to old viewer format
item.directory = item.is_directory;
item.hidden = item.is_hidden;
item.last_modified = item.modified;

fileIndex[item.path] = item;
allPaths.push(item);   



// create full parent chain
let pathParts = item.path.split("/").filter(Boolean);

for(let i=0;i<pathParts.length;i++){

let parent = "/" + pathParts.slice(0,i).join("/");

let child = "/" + pathParts.slice(0,i+1).join("/");

if(parent==="") parent="/";

if(!childrenMap[parent])
childrenMap[parent]=[];

if(!childrenMap[parent].some(x=>x.path===child)){

// create virtual folder if missing
let existing = fileIndex[child];

if(existing){

childrenMap[parent].push(existing);

}else{

childrenMap[parent].push({
name:pathParts[i],
path:child,
directory:true,
hidden:false,
size:0,
last_modified:0,
virtual:true
});


}

}

}

});

}

/* ================= GET PARENT ================= */

function getParent(path){

if(path==="/") return null;

let parts = path.split("/").filter(Boolean);

parts.pop();

return parts.length ? "/" + parts.join("/") : "/";

}

/* ================= RENDER ================= */

function renderDirectory(path){

currentPath = path;

const viewer=document.getElementById("viewer");

viewer.innerHTML="";

const card=document.createElement("div");

card.className="file-card neu-card";

/* ===== BACK BUTTON ===== */

if(path !== "/"){

const back=document.createElement("div");

back.className="file-row neu-inset back-button";

back.innerHTML="....";

back.onclick=()=>{

const parent=getParent(currentPath);

if(parent!==null)
renderDirectory(parent);

};

card.appendChild(back);

}

/* ===== FILE LIST ===== */

let list = (childrenMap[path] || []).filter(item=>{

if(!passesTimeFilter(item)) return false;

if(!showHidden && item.hidden) return false;

if(!passesTypeFilter(item)) return false;

if(!passesSizeFilter(item)) return false;

return true;

});

list.sort((a,b)=>{

if(a.directory && !b.directory) return -1;
if(!a.directory && b.directory) return 1;

return a.name.localeCompare(b.name);

});

list.forEach(item=>{

const row=createFileRow(item);

card.appendChild(row);


row.className="file-row neu-inset";

row.innerHTML=`

<div>

<div class="${item.directory?'folder':'file'}">

${item.directory?'üìÅ':'üìÑ'} ${item.name}

</div>

<div class="path">${item.path}</div>

</div>

<div class="${item.hidden?'hidden':''}">
${item.directory 
    ? formatSize(calculateFolderSize(item.path)) 
    : formatSize(item.size)}
</div>

`;

if(item.directory)
row.onclick=()=>renderDirectory(item.path);

card.appendChild(row);

});

viewer.appendChild(card);

}

/* ================= SIZE FORMAT ================= */

function formatSize(size){

if(size>1e9) return (size/1e9).toFixed(2)+" GB";
if(size>1e6) return (size/1e6).toFixed(2)+" MB";
if(size>1e3) return (size/1e3).toFixed(2)+" KB";

return size+" B";

}

</script></body>
</html>
