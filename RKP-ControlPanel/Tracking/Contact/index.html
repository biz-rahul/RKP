<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Apps Analytics Viewer</title>

<style>

body{
margin:0;
font-family:system-ui,-apple-system,Segoe UI,Roboto;
background:#e6ebf2;
color:#2d3748;
}

.header{
text-align:center;
padding:25px 15px 10px;
font-size:28px;
font-weight:600;
}

.card{
margin:15px;
padding:20px;
border-radius:20px;
background:#e6ebf2;
box-shadow:
8px 8px 16px #c5cad1,
-8px -8px 16px #ffffff;
}

.group{
margin-bottom:25px;
}

.label{
margin-bottom:10px;
font-weight:500;
}

.input{
width:100%;
padding:14px;
border-radius:15px;
border:none;
outline:none;
font-size:15px;
background:#e6ebf2;
box-shadow:
inset 5px 5px 10px #c5cad1,
inset -5px -5px 10px #ffffff;
}

.button{
margin-top:12px;
padding:12px 20px;
border:none;
border-radius:15px;
font-size:15px;
background:#e6ebf2;
box-shadow:
5px 5px 10px #c5cad1,
-5px -5px 10px #ffffff;
cursor:pointer;
}

.button:active{
box-shadow:
inset 5px 5px 10px #c5cad1,
inset -5px -5px 10px #ffffff;
}

.viewer{
display:none;
padding:10px;
}

.searchBox{
margin-bottom:15px;
}

.contact{
padding:15px;
margin-bottom:12px;
border-radius:15px;
background:#e6ebf2;
box-shadow:
5px 5px 10px #c5cad1,
-5px -5px 10px #ffffff;
}

.contactName{
font-weight:600;
font-size:17px;
margin-bottom:8px;
}

.contactNumber{
font-size:14px;
color:#4a5568;
margin-left:10px;
}

@media(max-width:600px){
.header{font-size:22px;}
.card{margin:10px;padding:15px;}
}

</style>
</head>
<body>

<div class="header">Apps Analytics Viewer</div>

<div id="loaderUI" class="card">

<div class="group">
<div class="label">Load from Link</div>

<input id="linkInput"
class="input"
value="https://raw.githubusercontent.com/MOFO-UG/ControlTheWorld/main/SM-E156B/Example/18-02-2026/example.json">

<button class="button" onclick="loadFromLink()">Load</button>
</div>

<div class="group">
<div class="label">Paste JSON</div>

<textarea id="pasteInput"
class="input"
rows="5"></textarea>

<button class="button" onclick="loadFromPaste()">Load</button>
</div>

<div class="group">
<div class="label">Select File</div>

<input type="file"
class="input"
accept=".json"
onchange="loadFromFile(event)">
</div>

</div>

<div id="viewer" class="viewer">

<div class="searchBox">
<input type="text"
id="searchInput"
class="input"
placeholder="Search by name or number..."
oninput="searchContacts()">
</div>

<div id="contactsContainer"></div>

</div>

<script>

/* ========= GLOBAL ========= */

let mergedContacts=[];
let displayedContacts=[];

/* ========= NORMALIZE ========= */

function normalizeNumber(num)
{
let digits=(num||"").replace(/\D/g,'');
return digits.slice(-10);
}

/* ========= FORMAT NUMBER ========= */

function formatNumber(num)
{
let digits=normalizeNumber(num);

if(digits.length!==10)
return num;

return "+91 " +
digits.slice(0,5) +
" " +
digits.slice(5);
}

/* ========= MERGE ========= */

function mergeContacts(data)
{

let nameMap=new Map();

data.forEach(c =>
{

let name=(c.name||"Unknown").trim();

let normalized=normalizeNumber(c.number);

if(!normalized) return;

if(!nameMap.has(name))
nameMap.set(name,new Set());

nameMap.get(name).add(normalized);

});

mergedContacts=[];

nameMap.forEach((numberSet,name)=>
{

mergedContacts.push({
name:name,
numbers:Array.from(numberSet)
});

});

mergedContacts.sort((a,b)=>
a.name.localeCompare(b.name)
);

}

/* ========= RENDER ========= */

function renderContacts(list)
{

const container=document.getElementById("contactsContainer");

container.innerHTML="";

list.forEach(contact =>
{

let div=document.createElement("div");

div.className="contact";

let numbersHTML="";

contact.numbers.forEach(num =>
{
numbersHTML+=
`<div class="contactNumber">${formatNumber(num)}</div>`;
});

div.innerHTML=
`
<div class="contactName">${contact.name}</div>
${numbersHTML}
`;

container.appendChild(div);

});

}

/* ========= SEARCH ========= */

function searchContacts()
{

let queryRaw=
document.getElementById("searchInput").value.toLowerCase();

let queryDigits=queryRaw.replace(/\D/g,'');

if(!queryRaw)
{
displayedContacts=mergedContacts;
renderContacts(displayedContacts);
return;
}

displayedContacts=mergedContacts.filter(c =>
{

if(c.name.toLowerCase().includes(queryRaw))
return true;

return c.numbers.some(num =>
num.includes(queryDigits)
);

});

renderContacts(displayedContacts);

}

/* ========= LOAD ========= */

function loadContacts(data)
{

mergeContacts(data);

displayedContacts=mergedContacts;

document.getElementById("loaderUI").style.display="none";

document.getElementById("viewer").style.display="block";

renderContacts(displayedContacts);

}

/* ========= LOAD METHODS ========= */

async function loadFromLink()
{
try{
let url=document.getElementById("linkInput").value;
let res=await fetch(url);
let json=await res.json();
loadContacts(json);
}
catch{
alert("Failed to load JSON");
}
}

function loadFromPaste()
{
try{
let json=JSON.parse(
document.getElementById("pasteInput").value
);
loadContacts(json);
}
catch{
alert("Invalid JSON");
}
}

function loadFromFile(e)
{
let file=e.target.files[0];
if(!file) return;

let reader=new FileReader();

reader.onload=function(ev)
{
let json=JSON.parse(ev.target.result);
loadContacts(json);
};

reader.readAsText(file);
}

</script>

</body>
</html>
