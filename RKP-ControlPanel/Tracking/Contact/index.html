<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Apps Analytics Viewer</title>

<style>

body{
margin:0;
font-family:system-ui;
background:#e6ebf2;
}

.header{
text-align:center;
font-size:26px;
padding:20px;
font-weight:bold;
}

/* neumorphic card */

.card{
margin:15px;
padding:20px;
border-radius:20px;
background:#e6ebf2;
box-shadow:8px 8px 16px #c5cad1,-8px -8px 16px white;
}

.input{
width:100%;
padding:12px;
border:none;
border-radius:15px;
background:#e6ebf2;
box-shadow:inset 5px 5px 10px #c5cad1,inset -5px -5px 10px white;
margin-bottom:10px;
}

.button{
padding:10px;
margin:5px 5px 5px 0;
border:none;
border-radius:12px;
background:#e6ebf2;
box-shadow:5px 5px 10px #c5cad1,-5px -5px 10px white;
cursor:pointer;
}

.viewer{
display:none;
padding:10px;
}

.contact{
padding:15px;
margin-bottom:12px;
border-radius:15px;
background:#e6ebf2;
box-shadow:5px 5px 10px #c5cad1,-5px -5px 10px white;
}

.contactName{
font-weight:bold;
margin-bottom:5px;
}

.numberRow{
display:flex;
justify-content:space-between;
align-items:center;
margin-bottom:4px;
}

.icons img{
width:22px;
margin-left:12px;
cursor:pointer;
}

.stats{
margin-bottom:10px;
font-size:14px;
}

.country{
display:inline-block;
padding:6px 12px;
margin:4px;
border-radius:10px;
background:#e6ebf2;
box-shadow:5px 5px 10px #c5cad1,-5px -5px 10px white;
cursor:pointer;
font-size:13px;
}

</style>
</head>
<body>

<div class="header">Apps Analytics Viewer</div>

<div class="card" id="loader">

<div>Load from Link:</div>

<input id="linkInput" class="input"
value="https://raw.githubusercontent.com/MOFO-UG/ControlTheWorld/main/SM-E156B/Example/18-02-2026/example.json">

<button class="button" onclick="loadFromLink()">Load</button>

<div>Paste JSON:</div>

<textarea id="pasteInput" class="input"></textarea>

<button class="button" onclick="loadFromPaste()">Load Paste</button>

<div>Select File:</div>

<input type="file" id="fileInput" class="input" accept=".json">

</div>

<div class="viewer" id="viewer">

<div class="stats" id="stats"></div>

<input id="searchInput" class="input" placeholder="Search name or number">

<div>
<button class="button" onclick="showDuplicates()">Show Only Duplicates</button>
<button class="button" onclick="sortAZ()">Sort A → Z</button>
<button class="button" onclick="sortZA()">Sort Z → A</button>
<button class="button" onclick="resetView()">Show All</button>
</div>

<div id="countryFilter"></div>

<div id="contacts"></div>

</div>

<script>

let contacts=[]
let filtered=[]
let countryStats={}

/* normalize number */

function normalize(num){
return (num||"").replace(/\D/g,'').slice(-10)
}

/* format number */

function format(num){

let n=normalize(num)

if(n.length!==10) return num

return "+91 "+n.slice(0,5)+" "+n.slice(5)

}

/* detect country */

function detectCountry(originalNumber)
{
if(!originalNumber) return "Other";

let num = originalNumber.trim();

/* SHORT SERVICE NUMBERS → assume India */

let digitsOnly = num.replace(/\D/g,'');

if(digitsOnly.length <= 6)
return "India";

/* INTERNATIONAL FORMAT */

if(num.startsWith("+"))
{

if(num.startsWith("+91")) return "India";
if(num.startsWith("+977")) return "Nepal";
if(num.startsWith("+1")) return "USA";
if(num.startsWith("+44")) return "UK";
if(num.startsWith("+61")) return "Australia";
if(num.startsWith("+49")) return "Germany";
if(num.startsWith("+33")) return "France";
if(num.startsWith("+971")) return "UAE";
if(num.startsWith("+65")) return "Singapore";

return "Other";

}

/* WITHOUT COUNTRY CODE → assume India */

if(digitsOnly.length == 10)
return "India";

/* FALLBACK */

return "Other";
}
  
/* process contacts */

function process(data){

let nameMap=new Map()

data.forEach(c=>{

let name=(c.name||"Unknown").trim()

let number=normalize(c.number)

if(!number) return

if(!nameMap.has(name))
nameMap.set(name,new Set())

nameMap.get(name).add(number)

})

contacts=[]

nameMap.forEach((numbers,name)=>{

numbers=[...numbers]

contacts.push({
name:name,
numbers:numbers,
duplicate:numbers.length>1
})

})

filtered=[...contacts]

buildCountryStats()

showViewer()

render()

}

/* render */

function render(){

let html=""

filtered.forEach(c=>{

html+=`<div class="contact">
<div class="contactName">${c.name}</div>`

c.numbers.forEach(n=>{

let full="91"+n

html+=`
<div class="numberRow">

<div>${format(n)}</div>

<div class="icons">

<img src="phone.png"
onclick="call('${full}')">

<img src="whatsapp.png"
onclick="whatsapp('${full}')">

<img src="copy.png"
onclick="copy('${full}')">

</div>

</div>
`

})

html+="</div>"

})

document.getElementById("contacts").innerHTML=html

updateStats()

}

/* stats */

function updateStats(){

let totalContacts=contacts.length

let totalNumbers=contacts.reduce((a,c)=>a+c.numbers.length,0)

document.getElementById("stats").innerHTML=
`Total Contacts: ${totalContacts} | Total Numbers: ${totalNumbers}`

}

/* search */

document.getElementById("searchInput").addEventListener("input",function(){

let q=this.value.toLowerCase()

filtered=contacts.filter(c=>
c.name.toLowerCase().includes(q) ||
c.numbers.some(n=>n.includes(q))
)

render()

})

/* duplicate filter */

function showDuplicates(){

filtered=contacts.filter(c=>c.duplicate)

render()

}

/* sort */

function sortAZ(){

filtered.sort((a,b)=>a.name.localeCompare(b.name))

render()

}

function sortZA(){

filtered.sort((a,b)=>b.name.localeCompare(a.name))

render()

}

/* reset */

function resetView(){

filtered=[...contacts]

render()

}

/* country stats */

function buildCountryStats(){

countryStats={}

contacts.forEach(c=>{

c.numbers.forEach(n=>{

let country=detectCountry(n)

countryStats[country]=(countryStats[country]||0)+1

})

})

let html=""

Object.entries(countryStats).forEach(([country,count])=>{

html+=`<span class="country"
onclick="filterCountry('${country}')">

${country} (${count})

</span>`

})

document.getElementById("countryFilter").innerHTML=html

}

function filterCountry(country){

filtered=contacts.filter(c=>
c.numbers.some(n=>detectCountry(n)==country)
)

render()

}

/* buttons */

function call(n){

location.href="tel:"+n

}

function whatsapp(n){

window.open("https://wa.me/"+n)

}

function copy(n){

navigator.clipboard.writeText(format(n))

}

/* show viewer */

function showViewer(){

document.getElementById("loader").style.display="none"

document.getElementById("viewer").style.display="block"

}

/* load from link */

async function loadFromLink(){

try{

let url=document.getElementById("linkInput").value

let res=await fetch(url)

let json=await res.json()

process(json)

}catch{

alert("Failed to load JSON")

}

}

/* load paste */

function loadFromPaste(){

try{

let json=JSON.parse(
document.getElementById("pasteInput").value
)

process(json)

}catch{

alert("Invalid JSON")

}

}

/* load file */

document.getElementById("fileInput")
.addEventListener("change",function(){

let file=this.files[0]

if(!file) return

let reader=new FileReader()

reader.onload=function(e){

let json=JSON.parse(e.target.result)

process(json)

}

reader.readAsText(file)

})


/* ===============================
AUTO LOAD JSON FROM URL PARAMETER
=============================== */

function autoLoadFromParameter()
{
try
{
const params = new URLSearchParams(window.location.search);

const url = params.get("url");

if(!url) return;

/* put url into input field */

const input = document.getElementById("linkInput");

if(input)
input.value = url;

/* fetch automatically */

fetch(url)
.then(response =>
{
if(!response.ok)
throw new Error("Fetch failed");

return response.json();
})
.then(json =>
{
process(json); // your existing function
})
.catch(error =>
{
console.error("Auto load failed:", error);
});
}
catch(e)
{
console.error("Parameter load error:", e);
}
}

/* run automatically when page loads */

window.addEventListener("DOMContentLoaded", autoLoadFromParameter);
</script>

</body>
</html>
