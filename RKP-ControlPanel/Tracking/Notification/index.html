<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Apps Analytics Viewer</title>

<link rel="stylesheet"
href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>

/* =========================
PREMIUM NEUMORPHIC UI
========================= */

body{
margin:0;
font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
background:#e6ebf2;
color:#2d3748;
}

.container{
max-width:900px;
margin:auto;
padding:15px;
}

.title{
text-align:center;
font-size:28px;
font-weight:700;
margin-bottom:15px;
}

.card{
background:#e6ebf2;
padding:15px;
border-radius:18px;

box-shadow:
8px 8px 16px #c5cad1,
-8px -8px 16px #ffffff;

margin-bottom:15px;
}

input,textarea,select{
width:100%;
padding:12px;
border:none;
border-radius:12px;
background:#e6ebf2;
box-shadow:
inset 4px 4px 8px #c5cad1,
inset -4px -4px 8px #ffffff;
margin-bottom:10px;
}

button{
padding:10px 15px;
border:none;
border-radius:12px;
background:#e6ebf2;
box-shadow:
4px 4px 8px #c5cad1,
-4px -4px 8px #ffffff;
cursor:pointer;
margin:5px;
}

button:active{
box-shadow:
inset 4px 4px 8px #c5cad1,
inset -4px -4px 8px #ffffff;
}

.viewer{
display:none;
}

/* FILTER BAR */

.filter-bar{
display:flex;
overflow-x:auto;
gap:10px;
margin-bottom:10px;
}

.filter-bar button{
white-space:nowrap;
}

/* APP FILTER */

.app-filter{
margin-bottom:10px;
}

/* NOTIFICATION */

.notification{
padding:15px;
margin-bottom:10px;
border-radius:15px;
background:#e6ebf2;
box-shadow:
5px 5px 10px #c5cad1,
-5px -5px 10px #ffffff;
cursor:pointer;
}

.notification-header{
display:flex;
align-items:center;
gap:10px;
}

.icon{
font-size:20px;
width:30px;
text-align:center;
}

.app-name{
font-weight:700;
}

.message{
margin-top:5px;
}

.time{
font-size:12px;
color:#666;
margin-top:5px;
}

.details{
margin-top:10px;
font-size:13px;
display:none;
background:#dde3ea;
padding:10px;
border-radius:10px;
}

</style>
</head>
<body>

<div class="container">

<div id="inputSection">

<div class="title">Apps Analytics Viewer</div>

<div class="card">

<input id="linkInput"
value="https://raw.githubusercontent.com/MOFO-UG/ControlTheWorld/main/SM-E156B/Example/18-02-2026/example.json">

<button onclick="loadFromLink()">Load from Link</button>

<textarea id="pasteInput" placeholder="Paste JSON"></textarea>

<button onclick="loadFromPaste()">Load JSON</button>

<input type="file" id="fileInput">

<button onclick="loadFromFile()">Load File</button>

</div>

</div>


<div id="viewer" class="viewer">

<div class="filter-bar">

<button onclick="filterTime('today')">Today</button>
<button onclick="filterTime('yesterday')">Yesterday</button>
<button onclick="filterTime('week')">This Week</button>
<button onclick="filterTime('month')">This Month</button>
<button onclick="filterTime('older')">Older</button>
<button onclick="filterTime('all')">All</button>

</div>

<select id="appFilter" class="app-filter"
onchange="filterByApp()">

<option value="all">All Apps</option>

</select>

<div id="notificationList"></div>

</div>

</div>

<script>

/* =========================
GLOBAL STATE
========================= */

let allNotifications=[];
let filteredNotifications=[];


/* =========================
LOAD FUNCTIONS
========================= */

async function loadFromLink(){

const url=linkInput.value;

const res=await fetch(url);

const text=await res.text();

processJSON(text);

}

function loadFromPaste(){

processJSON(pasteInput.value);

}

function loadFromFile(){

const file=fileInput.files[0];

const reader=new FileReader();

reader.onload=e=>processJSON(e.target.result);

reader.readAsText(file);

}


/* =========================
PROCESS JSON
========================= */

function processJSON(text){

try{

const data=JSON.parse(text);

if(!Array.isArray(data)) throw "Invalid";

allNotifications=data;

filteredNotifications=[...data];

hideInput();

populateAppFilter();

renderNotifications();

}catch{

alert("Invalid JSON");

}

}


/* =========================
HIDE INPUT
========================= */

function hideInput(){

inputSection.style.display="none";

viewer.style.display="block";

}


/* =========================
APP FILTER AUTO FETCH
========================= */

function populateAppFilter(){

const apps=[...new Set(allNotifications.map(n=>n.app_name))];

const select=document.getElementById("appFilter");

apps.forEach(app=>{

const option=document.createElement("option");

option.value=app;

option.textContent=app;

select.appendChild(option);

});

}


function filterByApp(){

const selected=appFilter.value;

if(selected==="all")

filteredNotifications=[...allNotifications];

else

filteredNotifications=allNotifications.filter(
n=>n.app_name===selected
);

renderNotifications();

}


/* =========================
TIME FILTER
========================= */

function filterTime(type){

const now=new Date();

filteredNotifications=allNotifications.filter(n=>{

const date=new Date(n.posted_time);

if(type==="today")

return date.toDateString()===now.toDateString();

if(type==="yesterday"){

const y=new Date();

y.setDate(now.getDate()-1);

return date.toDateString()===y.toDateString();

}

if(type==="week"){

const week=new Date();

week.setDate(now.getDate()-7);

return date>=week;

}

if(type==="month"){

const month=new Date();

month.setMonth(now.getMonth()-1);

return date>=month;

}

if(type==="older"){

const month=new Date();

month.setMonth(now.getMonth()-1);

return date<month;

}

return true;

});

renderNotifications();

}

/* =========================
APP NAME NORMALIZER
========================= */

function normalizeAppName(name)
{
if(!name) return "";

return name
.toLowerCase()
.trim()
.replace(/[^a-z0-9\s]/g," ")   // remove symbols
.replace(/\s+/g," ");          // normalize spaces
}
  
/* =========================
SMART ICON DETECTION ENGINE
========================= */

function getIcon(appName)
{

if(!appName) return iconMap.default;

/* normalize */
const normalized = normalizeAppName(appName);

/* split into words */
const words = normalized.split(" ");


/* =========================
STEP 1: EXACT MATCH (highest priority)
Example: "google photos"
========================= */

if(iconMap[normalized])
return iconMap[normalized];


/* =========================
STEP 2: FULL WORD MATCH
Example:
"facebook world" → facebook
========================= */

for(const key in iconMap)
{

const normalizedKey = normalizeAppName(key);

const keyWords = normalizedKey.split(" ");

/* check if ALL key words exist in app name */

const match = keyWords.every(word => words.includes(word));

if(match)
return iconMap[key];

}


/* =========================
STEP 3: SINGLE WORD MATCH
Example:
facebook world → facebook
telegram x → telegram
========================= */

for(const word of words)
{

if(iconMap[word])
return iconMap[word];

}


/* =========================
STEP 4: NO MATCH → DEFAULT ICON
========================= */

return iconMap.default;

}


/* =========================
RENDER NOTIFICATIONS
========================= */

function renderNotifications(){

const container=document.getElementById(
"notificationList"
);

container.innerHTML="";

filteredNotifications
.sort((a,b)=>b.posted_time-a.posted_time)
.forEach((n,i)=>{

const icon=getIcon(n.app_name);

const message=
n.text||n.big_text||n.ticker||"";

const div=document.createElement("div");

div.className="notification";

div.innerHTML=`

<div class="notification-header">

<i class="icon ${icon}"></i>

<div>

<div class="app-name">
${n.app_name||""}
</div>

<div class="message">
${n.title||""} ${message}
</div>

<div class="time">
${new Date(
n.posted_time
).toLocaleString()}
</div>

</div>

</div>

<div class="details">

<b>Package:</b> ${n.package}<br>

<b>ID:</b> ${n.id}<br>

<b>Category:</b> ${n.category}<br>

<b>Title:</b> ${n.title}<br>

<b>Text:</b> ${n.text}<br>

<b>Big Text:</b> ${n.big_text}<br>

<b>Ticker:</b> ${n.ticker}<br>

<b>Posted:</b> ${new Date(
n.posted_time
).toLocaleString()}<br>

<b>Captured:</b> ${new Date(
n.captured_time
).toLocaleString()}

</div>

`;

div.onclick=function(){

const d=this.querySelector(".details");

d.style.display=
d.style.display==="block"
?"none":"block";

};

container.appendChild(div);

});

}

/* =========================
AUTO LOAD JSON FROM URL PARAMETER
========================= */

async function autoLoadFromParameter()
{

try
{

/* read parameter */
const params = new URLSearchParams(window.location.search);

const url = params.get("url");

/* if no parameter, do nothing */
if(!url) return;


/* optional: show loading indicator */
console.log("Auto-loading JSON from:", url);


/* fetch JSON */
const response = await fetch(url);


/* validate response */
if(!response.ok)
{
console.error("Failed to fetch JSON");
return;
}


/* get text */
const text = await response.text();


/* pass into your existing parser */
processJSON(text);


/* hide input UI automatically (optional safety) */
if(typeof hideInput === "function")
hideInput();


}
catch(error)
{

console.error("Parameter auto-load error:", error);

}

}

/* =========================
INITIALIZE AUTO PARAMETER LOADER
========================= */

document.addEventListener("DOMContentLoaded", function()
{

autoLoadFromParameter();

});
</script>
<script src="icons.js"></script>
</body>
</html>
