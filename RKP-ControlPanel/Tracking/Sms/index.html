<!DOCTYPE html><html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Apps Analytics Viewer</title><style>

/* ---------- BASE ---------- */

body{
margin:0;
font-family:system-ui,-apple-system,Segoe UI,Roboto;
background:#e4e8ee;
color:#1f2937;
}

/* ---------- NEUMORPHIC ---------- */

.neu{
background:#e4e8ee;
border-radius:24px;
box-shadow:
10px 10px 22px #c2c8d0,
-10px -10px 22px #ffffff;
}

/* ---------- LOAD SCREEN FIXED SIZE ---------- */

#loadScreen{
padding:30px;
max-width:720px;   /* FIXED larger width */
margin:auto;
}

.title{
text-align:center;
font-size:34px;
font-weight:700;
margin:40px 0;
}

.card{
padding:30px;
}

input,textarea{
width:100%;
padding:18px;
margin-top:10px;
margin-bottom:20px;
border:none;
outline:none;
border-radius:16px;
background:#e4e8ee;
font-size:16px;
box-shadow:
inset 6px 6px 12px #c2c8d0,
inset -6px -6px 12px #ffffff;
}

textarea{
height:160px; /* FIXED larger textarea */
}

button{
padding:14px 28px;
border:none;
border-radius:14px;
background:#e4e8ee;
box-shadow:
6px 6px 12px #c2c8d0,
-6px -6px 12px #ffffff;
cursor:pointer;
margin-bottom:20px;
font-size:15px;
}

/* ---------- APP ---------- */

#app{
display:none;
height:100vh;
flex-direction:column;
}

/* ---------- HEADER ---------- */

.header{
display:flex;
align-items:center;
gap:12px;
padding:16px;
}

.header img{
width:28px;
height:28px;
cursor:pointer;
}

.contactIcon{
width:40px;
height:40px;
border-radius:50%;
}

/* ---------- THREAD LIST ---------- */

#threadList{
flex:1;
overflow:auto;
padding:12px;
}

.thread{
display:flex;
align-items:center;
gap:14px;
padding:14px;
margin-bottom:12px;
cursor:pointer;
}

.thread img{
width:48px;
height:48px;
border-radius:50%;
}

.threadContent{
flex:1;
}

.threadName{
font-weight:600;
font-size:16px;
}

.threadPreview{
font-size:14px;
opacity:0.7;
}

.threadTime{
font-size:12px;
opacity:0.6;
}

/* ---------- MESSAGE VIEW ---------- */

#messageView{
display:none;
flex-direction:column;
height:100%;
}

#messages{
flex:1;
overflow:auto;
padding:16px;
}

/* ---------- BUBBLES ---------- */

.msgRow{
display:flex;
margin:6px 0;
}

.inboxRow{
justify-content:flex-start;
}

.sentRow{
justify-content:flex-end;
}

.bubble{
padding:12px 16px;
border-radius:18px;
max-width:75%;
box-shadow:2px 2px 6px rgba(0,0,0,0.1);
font-size:15px;
}

.inboxBubble{
background:white;
}

.sentBubble{
background:#dcfce7;
}

.timeLabel{
text-align:center;
font-size:12px;
opacity:0.6;
margin:12px 0;
}

</style></head>
<body><!-- LOAD SCREEN --><div id="loadScreen"><div class="title">Apps Analytics Viewer</div><div class="card neu">Load from Link
<input id="linkInput"
value="https://raw.githubusercontent.com/MOFO-UG/ControlTheWorld/main/SM-E156B/Example/18-02-2026/example.json">

<button onclick="loadFromLink()">Load</button>

Paste JSON

<textarea id="pasteInput"></textarea><button onclick="loadFromPaste()">Load</button>

Select File
<input type="file" id="fileInput">

</div></div><!-- APP --><div id="app">
  <div id="statsBar" style="padding:10px;font-weight:600;"></div>
  <button onclick="openSearch()">Search</button>
<div id="searchBox" style="display:none">
<input id="searchInput">
<button onclick="searchContact()">Contact</button>
<button onclick="searchMessage()">Message</button>
</div>
  <button onclick="filterReal()">Real Person</button>
  <button onclick="filterBank()">Bank</button>
  <button onclick="filterDate('today')">Today</button>
<button onclick="filterDate('yesterday')">Yesterday</button>
<button onclick="filterDate('week')">This Week</button>
<button onclick="filterDate('month')">This Month</button>
<button onclick="resetFilters()">All</button>




  <div id="threadList">
    
  </div><div id="messageView"><div class="header neu"><img src="back.png" onclick="showThreads()"><img src="hacker.png" class="contactIcon"><div id="contactName"></div></div><div id="messages"></div></div></div><script>

/* ---------- GLOBAL ---------- */

let data=[];
let filteredData = [];
let currentFilter = "all";
let totalMessages = 0;


/* ---------- LOAD ---------- */

function showApp(){

loadScreen.style.display="none";
app.style.display="flex";

}

function getDisplayName(thread){

if(thread.name && thread.name !== "Unknown")
return thread.name;

return thread.address;

}

function filterDate(type){

filteredData = data.filter(thread=>{

let last = Math.max(...thread.messages.map(m=>m.date));

return isInDateFilter(last,type);

});

renderThreads();

}

function openSearch(){
searchBox.style.display="block";
}

function searchContact(){

let q = searchInput.value.toLowerCase();

filteredData = data.filter(t=>
t.address.toLowerCase().includes(q) ||
getDisplayName(t).toLowerCase().includes(q)
);

renderThreads();

}

function resetFilters(){

filteredData=[];

renderThreads();

}


function searchMessage(){

let q = searchInput.value.toLowerCase();

filteredData = data.filter(t=>
t.messages.some(m=>m.body.toLowerCase().includes(q))
);

renderThreads();

}

function updateCounts(){

let contacts = (filteredData.length || data.length);

let messages = (filteredData.length || data)
.reduce((sum,t)=>sum+t.messages.length,0);

statsBar.innerText =
`Contacts: ${contacts}   Messages: ${messages}`;

}

  
function isRealPerson(address){

let normalized = address
.replace(/\s+/g,"")
.replace(/-/g,"")
.replace(/\(/g,"")
.replace(/\)/g,"");

return /^\+\d{8,15}$/.test(normalized);

}

function filterBank(){

filteredData = data.filter(t=>isBankThread(t));

renderThreads();

}

function isBankThread(thread){

let keywords = [
"bank","upi","credited","debited",
"account","a/c","transaction","payment"
];

return thread.messages.some(msg=>{

let text = msg.body.toLowerCase();

return keywords.some(k=>text.includes(k));

});

}

function filterReal(){

filteredData = data.filter(t=>isRealPerson(t.address));

renderThreads();

}

function isInDateFilter(timestamp,filter){

let now = new Date();
let msgDate = new Date(timestamp);

let diffDays = (now - msgDate)/(1000*60*60*24);

if(filter=="today")
return msgDate.toDateString()==now.toDateString();

if(filter=="yesterday")
return diffDays>=1 && diffDays<2;

if(filter=="week")
return diffDays<=7;

if(filter=="month")
return diffDays<=30;

return true;

}

  
function loadJSON(text){

data=JSON.parse(text);

renderThreads();
showApp();

}

async function loadFromLink(){

let res=await fetch(linkInput.value);
let text=await res.text();
loadJSON(text);

}

function loadFromPaste(){

loadJSON(pasteInput.value);

}

fileInput.onchange=e=>{

let reader=new FileReader();
reader.onload=x=>loadJSON(x.target.result);
reader.readAsText(e.target.files[0]);

};

/* ---------- DATE FORMAT ---------- */

function formatListTime(timestamp){

let d=new Date(timestamp);
let now=new Date();

if(d.toDateString()==now.toDateString())
return d.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});

return d.toLocaleDateString();

}

function formatMessageTime(timestamp){

let d=new Date(timestamp);
let now=new Date();

if(d.toDateString()==now.toDateString())
return d.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});

return d.toLocaleDateString()+" "+d.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});

}

/* ---------- THREAD LIST ---------- */

function renderThreads(){

threadList.innerHTML="";

let source = filteredData.length ? filteredData : data;

let sorted=[...source].sort((a,b)=>{

return Math.max(...b.messages.map(m=>m.date))
-
Math.max(...a.messages.map(m=>m.date));

});

sorted.forEach(thread=>{

let last=thread.messages.reduce((a,b)=>a.date>b.date?a:b);

let name = getDisplayName(thread);

let div=document.createElement("div");
div.className="thread neu";

div.innerHTML=`
<img src="contact.png" class="contactIcon">

<div class="threadContent">

<div class="threadName">${name}</div>

<div class="threadPreview">${last.body.substring(0,60)}</div>

</div>

<div class="threadTime">${formatListTime(last.date)}</div>
`;

div.onclick=()=>openThread(thread);

threadList.appendChild(div);

});

updateCounts();

}


/* ---------- OPEN THREAD ---------- */

function openThread(thread){

threadList.style.display="none";
messageView.style.display="flex";

let display = getDisplayName(thread);

contactName.innerHTML =
display +
"<div style='font-size:13px;opacity:0.7'>" +
thread.address +
"</div>" +
"<div style='font-size:12px;opacity:0.6'>" +
"Messages: "+thread.messages.length +
"</div>";


messages.innerHTML="";

let sorted=[...thread.messages].sort((a,b)=>a.date-b.date);

sorted.forEach(msg=>{

let time=document.createElement("div");
time.className="timeLabel";
time.innerText=formatMessageTime(msg.date);

messages.appendChild(time);

let row=document.createElement("div");
row.className="msgRow "+(msg.type_name=="SENT"?"sentRow":"inboxRow");

let bubble=document.createElement("div");
bubble.className="bubble "+(msg.type_name=="SENT"?"sentBubble":"inboxBubble");

bubble.innerText=msg.body;

row.appendChild(bubble);
messages.appendChild(row);

});

/* FIXED: auto scroll to newest message */

setTimeout(()=>{
messages.scrollTop=messages.scrollHeight;
},50);

}

/* ---------- BACK ---------- */

function showThreads(){

messageView.style.display="none";
threadList.style.display="block";

}

</script></body>
</html>
