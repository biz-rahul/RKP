<!DOCTYPE html><html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Apps Analytics Viewer</title><style>

/* ---------- BASE ---------- */

body{
margin:0;
font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
background:#e4e8ee;
color:#2d3748;
}

/* ---------- NEUMORPHIC ---------- */

.neu{
border-radius:20px;
background:#e4e8ee;
box-shadow:
10px 10px 20px #c2c8d0,
-10px -10px 20px #ffffff;
}

.neu-inset{
border-radius:15px;
background:#e4e8ee;
box-shadow:
inset 6px 6px 12px #c2c8d0,
inset -6px -6px 12px #ffffff;
}

/* ---------- LOAD SCREEN ---------- */

#loadScreen{
padding:20px;
max-width:600px;
margin:auto;
}

.title{
text-align:center;
font-size:32px;
font-weight:700;
margin:30px 0;
}

.card{
padding:25px;
}

label{
font-weight:600;
display:block;
margin:20px 0 10px;
}

input,textarea{
width:100%;
padding:15px;
border:none;
outline:none;
font-size:16px;
background:transparent;
}

textarea{
height:120px;
resize:none;
}

button{
margin-top:15px;
padding:12px 25px;
border:none;
border-radius:12px;
cursor:pointer;
background:#e4e8ee;
box-shadow:
6px 6px 12px #c2c8d0,
-6px -6px 12px #ffffff;
}

button:active{
box-shadow:
inset 4px 4px 8px #c2c8d0,
inset -4px -4px 8px #ffffff;
}

/* ---------- APP ---------- */

#app{
display:none;
height:100vh;
flex-direction:column;
}

header{
padding:15px;
margin:10px;
}

#stats{
font-size:14px;
margin-top:5px;
}

/* ---------- LAYOUT ---------- */

#main{
flex:1;
display:flex;
overflow:hidden;
}

#threads{
width:35%;
max-width:320px;
overflow:auto;
padding:10px;
}

.thread{
padding:15px;
margin-bottom:10px;
cursor:pointer;
}

.thread.active{
background:#dbeafe;
}

#messages{
flex:1;
overflow:auto;
padding:15px;
display:flex;
flex-direction:column;
}

/* ---------- WHATSAPP BUBBLES ---------- */

.msgRow{
display:flex;
margin:4px 0;
}

.msgBubble{
padding:10px 14px;
border-radius:18px;
max-width:75%;
font-size:15px;
position:relative;
}

.inboxRow{
justify-content:flex-start;
}

.sentRow{
justify-content:flex-end;
}

.inboxBubble{
background:#ffffff;
box-shadow:3px 3px 6px rgba(0,0,0,0.1);
}

.sentBubble{
background:#dcfce7;
box-shadow:3px 3px 6px rgba(0,0,0,0.1);
}

.msgTime{
font-size:11px;
opacity:0.6;
margin-top:4px;
}

/* ---------- CATEGORY ---------- */

.category{
text-align:center;
margin:15px 0 10px;
font-size:13px;
font-weight:600;
opacity:0.7;
}

/* ---------- MOBILE ---------- */

@media(max-width:700px){

#main{
flex-direction:column;
}

#threads{
width:100%;
max-width:none;
height:40%;
}

#messages{
height:60%;
}

.title{
font-size:26px;
}

}

</style></head>
<body><!-- LOAD SCREEN --><div id="loadScreen"><div class="title">Apps Analytics Viewer</div><div class="card neu"><label>Load from Link</label>
<input id="linkInput" class="neu-inset"
value="https://raw.githubusercontent.com/MOFO-UG/ControlTheWorld/main/SM-E156B/Example/18-02-2026/example.json">
<button onclick="loadFromLink()">Load</button>

<label>Paste JSON</label>

<textarea id="pasteInput" class="neu-inset"></textarea><button onclick="loadFromPaste()">Load</button>

<label>Select File</label>
<input type="file" id="fileInput" class="neu-inset">

</div></div><!-- APP --><div id="app"><header class="neu"><div id="threadTitle"><b>Messages</b></div>
<div id="stats"></div></header><div id="main"><div id="threads"></div>
<div id="messages"></div></div></div><script>

/* ---------- GLOBAL ---------- */

let smsData=[];
let credit=0;
let debit=0;

/* ---------- LOAD ---------- */

function showApp(){

document.getElementById("loadScreen").style.display="none";
document.getElementById("app").style.display="flex";

}

function loadJSON(text){

smsData=JSON.parse(text);

calculateStats();
renderThreads();
showApp();

}

async function loadFromLink(){

let res=await fetch(document.getElementById("linkInput").value);

let text=await res.text();

loadJSON(text);

}

function loadFromPaste(){

loadJSON(document.getElementById("pasteInput").value);

}

fileInput.onchange=e=>{

let reader=new FileReader();

reader.onload=x=>loadJSON(x.target.result);

reader.readAsText(e.target.files[0]);

};

/* ---------- STATS ---------- */

function extractAmount(text){

let m=text.match(/Rs\.?\s?([\d\.]+)/i);

return m?parseFloat(m[1]):0;

}

function calculateStats(){

credit=0;
debit=0;

smsData.forEach(t=>{

t.messages.forEach(m=>{

if(m.body.toLowerCase().includes("credited"))
credit+=extractAmount(m.body);

if(m.body.toLowerCase().includes("debited"))
debit+=extractAmount(m.body);

});

});

stats.innerText=
"Credit ₹"+credit+"   Debit ₹"+debit+
"   Net ₹"+(credit-debit);

}

/* ---------- THREADS ---------- */

function renderThreads(){

threads.innerHTML="";

smsData.forEach(thread=>{

let div=document.createElement("div");

div.className="thread neu";

div.innerHTML=
"<b>"+(thread.name||thread.address)+"</b><br>"+
thread.messages.length+" messages";

div.onclick=()=>selectThread(thread,div);

threads.appendChild(div);

});

}

/* ---------- CATEGORY ---------- */

function getCategory(date){

let now=new Date();

let d=new Date(date);

let diff=(now-d)/(1000*60*60*24);

if(diff<1) return "Today";
if(diff<2) return "Yesterday";
if(diff<7) return "This Week";
if(diff<30) return "This Month";
return "Older";

}

/* ---------- MESSAGES ---------- */

function selectThread(thread,element){

document.querySelectorAll(".thread")
.forEach(e=>e.classList.remove("active"));

element.classList.add("active");

threadTitle.innerHTML="<b>"+(thread.name||thread.address)+"</b>";

messages.innerHTML="";

let msgs=[...thread.messages]
.sort((a,b)=>b.date-a.date); // NEWEST FIRST

let lastCategory="";

msgs.forEach(msg=>{

let category=getCategory(msg.date);

if(category!==lastCategory){

let cat=document.createElement("div");
cat.className="category";
cat.innerText=category;

messages.appendChild(cat);

lastCategory=category;

}

let row=document.createElement("div");

row.className="msgRow "+
(msg.type_name==="SENT"?"sentRow":"inboxRow");

let bubble=document.createElement("div");

bubble.className="msgBubble "+
(msg.type_name==="SENT"?"sentBubble":"inboxBubble");

bubble.innerHTML=
msg.body+
"<div class='msgTime'>"+
new Date(msg.date).toLocaleString()+
"</div>";

row.appendChild(bubble);

messages.appendChild(row);

});

}

</script></body>
</html>
