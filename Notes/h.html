<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Advanced Notes Editor (Stable)</title>

<style>
*{
  margin:0;
  padding:0;
  box-sizing:border-box;
  font-family:"SF Pro Text",system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
}

/* APP BACKGROUND ‚Äì NEON + NOISE */
body{
  min-height:100vh;
  background:
    radial-gradient(circle at top left,#ff9ff3 0,transparent 55%),
    radial-gradient(circle at bottom right,#54a0ff 0,transparent 55%),
    radial-gradient(circle at top right,#feca57 0,transparent 45%),
    #050509;
  color:#fff;
  overflow-x:hidden;
  position:relative;
}
body::before{
  content:"";
  position:fixed;
  inset:0;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='160' height='160' viewBox='0 0 160 160'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.8' numOctaves='4' stitchTiles='noStitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='.16'/%3E%3C/svg%3E");
  mix-blend-mode:soft-light;
  pointer-events:none;
  z-index:-1;
  opacity:0.8;
}
body{
  animation:bodyIn 0.7s cubic-bezier(.21,.6,.32,1) forwards;
  opacity:0;
  transform:translateY(8px);
}
@keyframes bodyIn{
  to{opacity:1;transform:translateY(0);}
}

.app{
  max-width:520px;
  margin:auto;
  padding:22px 18px 40px;
}

/* HEADER ‚Äì LOGO LINE + TITLE */
header{
  position:relative;
  padding-bottom:8px;
  margin-bottom:6px;
}
header::after{
  content:"";
  position:absolute;
  left:0;
  bottom:0;
  width:80px;
  height:2px;
  border-radius:999px;
  background:linear-gradient(90deg,#ff9ff3,#54a0ff,#1dd1a1);
  box-shadow:0 0 12px rgba(255,159,243,.7);
}

header h1{
  font-size:28px;
  font-weight:800;
  letter-spacing:0.04em;
  text-transform:uppercase;
  margin-bottom:4px;
  background:conic-gradient(from 160deg,#ffffff,#ffeaa7,#ff9ff3,#54a0ff,#ffffff);
  -webkit-background-clip:text;
  color:transparent;
  filter:drop-shadow(0 0 18px rgba(0,0,0,.65));
}
header p{
  color:#c2c5ff;
  margin-bottom:4px;
  font-size:13px;
}
#greeting{
  font-size:12px;
  color:#ffeaa7;
  margin-bottom:12px;
  opacity:0.9;
  display:flex;
  align-items:center;
  gap:6px;
}
#greeting::before{
  content:"‚úçÔ∏è";
  font-size:13px;
}

/* NAV ‚Äì PILL TABS WITH GLOW */
header nav{
  display:flex;
  gap:8px;
  margin-bottom:14px;
  flex-wrap:wrap;
}
header nav button{
  position:relative;
  background:rgba(8,8,22,.9);
  border:1px solid rgba(255,255,255,.06);
  color:#f5f7ff;
  padding:7px 14px;
  border-radius:999px;
  cursor:pointer;
  font-size:12px;
  display:flex;
  align-items:center;
  gap:6px;
  backdrop-filter:blur(18px);
  box-shadow:
    0 12px 30px rgba(0,0,0,.85),
    0 0 0 1px rgba(255,255,255,.02);
  transition:
    transform .16s ease,
    box-shadow .18s ease,
    border-color .18s ease,
    background .18s ease,
    color .18s ease;
}
header nav button::before{
  content:"";
  position:absolute;
  inset:-1px;
  border-radius:inherit;
  background:radial-gradient(circle at 0 0,rgba(255,255,255,.3),transparent 55%);
  opacity:0;
  transition:opacity .22s ease;
  pointer-events:none;
}
header nav button:hover{
  transform:translateY(-1px);
  border-color:rgba(129,236,236,.7);
  background:radial-gradient(circle at 0 0,rgba(84,160,255,.65),rgba(8,8,22,.95));
  box-shadow:
    0 16px 36px rgba(0,0,0,.95),
    0 0 0 1px rgba(84,160,255,.55);
  color:#fdfcff;
}
header nav button:hover::before{
  opacity:1;
}
header nav button:active{
  transform:translateY(0);
  box-shadow:
    0 8px 18px rgba(0,0,0,.9),
    0 0 0 1px rgba(84,160,255,.45);
}

/* SEARCH BAR + AUTOSAVE */
.search-bar{
  display:flex;
  gap:8px;
  margin-bottom:16px;
  flex-wrap:wrap;
  align-items:center;
}

.search-bar input{
  flex:1;
  padding:10px 14px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.09);
  background:rgba(4,4,18,.92);
  color:#f5f7ff;
  font-size:13px;
  outline:none;
  box-shadow:
    inset 0 0 0 1px rgba(255,255,255,.03),
    0 14px 30px rgba(0,0,0,.9);
  backdrop-filter:blur(18px);
  transition:
    border-color .16s ease,
    box-shadow .18s ease,
    background .16s ease,
    transform .12s ease;
}
.search-bar input::placeholder{
  color:#6f74a8;
}
.search-bar input:focus{
  border-color:#ff9ff3;
  box-shadow:
    0 0 0 1px rgba(255,159,243,.7),
    0 20px 38px rgba(0,0,0,.98);
  background:radial-gradient(circle at 0 0,rgba(255,159,243,.10),rgba(6,6,24,.98));
  transform:translateY(-1px);
}

.search-bar button{
  background:radial-gradient(circle at 20% 0,#54a0ff,#341f97);
  border:1px solid rgba(255,255,255,.12);
  color:#fdfcff;
  padding:8px 11px;
  border-radius:999px;
  cursor:pointer;
  font-size:12px;
  display:flex;
  align-items:center;
  gap:4px;
  backdrop-filter:blur(14px);
  box-shadow:
    0 14px 30px rgba(0,0,0,.95),
    0 0 0 1px rgba(255,255,255,.04);
  transition:
    transform .14s ease,
    box-shadow .18s ease,
    border-color .18s ease,
    filter .16s ease;
}
.search-bar button:hover{
  transform:translateY(-1px) scale(1.02);
  border-color:rgba(84,160,255,.8);
  filter:saturate(1.15);
  box-shadow:
    0 18px 40px rgba(0,0,0,.98),
    0 0 0 1px rgba(84,160,255,.6);
}
.search-bar button:active{
  transform:translateY(0) scale(.97);
  box-shadow:
    0 10px 22px rgba(0,0,0,.92),
    0 0 0 1px rgba(84,160,255,.5);
}

#autosave-indicator{
  font-size:11px;
  color:#a5b4ff;
  min-width:78px;
  text-align:right;
  white-space:nowrap;
  animation:autosavePulse 2.2s ease-in-out infinite;
}
@keyframes autosavePulse{
  0%,100%{opacity:.55;transform:translateY(0);}
  50%{opacity:1;transform:translateY(-1px);}
}

/* NOTES GRID */
.notes{
  display:grid;
  gap:16px;
}

/* NOTE CARD ‚Äì GLASS + NEUMORPHISM */
.note{
  position:relative;
  cursor:pointer;
  min-height:80px;
  border-radius:24px;
  background:linear-gradient(135deg,rgba(255,255,255,.96),rgba(255,248,220,.95));
  box-shadow:
    0 22px 50px rgba(0,0,0,.85),
    0 0 0 1px rgba(255,255,255,.5);
  padding:18px 16px 28px;
  transform:translateY(0) scale(1);
  transition:
    transform .2s cubic-bezier(.16,.8,.3,1),
    box-shadow .2s ease,
    border-radius .18s ease,
    background .2s ease;
  overflow:hidden;
}
.note::before{
  content:"";
  position:absolute;
  inset:0;
  background:radial-gradient(circle at 0 0,rgba(255,255,255,.7),transparent 55%);
  opacity:0;
  transition:opacity .25s ease;
  pointer-events:none;
}
.note:hover{
  transform:translateY(-6px) scale(1.015);
  box-shadow:
    0 30px 70px rgba(0,0,0,.9),
    0 0 0 1px rgba(0,0,0,.06);
  border-radius:26px;
}
.note:hover::before{
  opacity:1;
}

/* PIN ICON ANIM */
.note.pinned::before{
  content:"üìå";
  position:absolute;
  top:9px;
  right:11px;
  font-size:18px;
  filter:drop-shadow(0 1px 2px rgba(0,0,0,.35));
  animation:pinFloat 1.6s ease-in-out infinite;
}
@keyframes pinFloat{
  0%,100%{transform:translateY(0);}
  50%{transform:translateY(-3px);}
}

.note h3{
  font-size:18px;
  font-weight:720;
  margin-bottom:6px;
  word-wrap:break-word;
  color:#1c1933;
}
.note p{
  font-size:14px;
  opacity:.9;
  word-wrap:break-word;
  line-height:1.45;
  color:#40384f;
}

/* META ROW */
.note-meta{
  font-size:11px;
  opacity:.95;
  margin-top:8px;
  display:flex;
  justify-content:space-between;
  gap:6px;
  flex-wrap:wrap;
  color:#5a4b3a;
}

/* MENU (3 DOTS) */
.menu-btn{
  position:absolute;
  bottom:8px;
  right:10px;
  font-size:20px;
  color:#4b365f;
  cursor:pointer;
  z-index:10;
  transition:transform .15s ease,opacity .15s ease;
  opacity:.78;
}
.menu-btn:hover{
  transform:scale(1.08) translateY(-1px);
  opacity:1;
}

/* ACTION MENU ‚Äì FLOATING GLASS SHEET */
.menu{
  position:absolute;
  right:10px;
  bottom:40px;
  background:radial-gradient(circle at top left,rgba(84,160,255,.35),rgba(12,12,30,.98));
  color:#fff;
  border-radius:14px;
  padding:6px;
  display:none;
  z-index:20;
  border:1px solid rgba(255,255,255,.22);
  box-shadow:
    0 22px 40px rgba(0,0,0,.95),
    0 0 0 1px rgba(255,255,255,.08);
  backdrop-filter:blur(22px);
  transform-origin:bottom right;
  animation:menuPop .18s ease-out;
}
@keyframes menuPop{
  from{opacity:0;transform:scale(.9) translateY(8px);}
  to{opacity:1;transform:scale(1) translateY(0);}
}
.menu button{
  background:none;
  border:none;
  color:#f5f7ff;
  padding:8px 11px;
  display:block;
  width:100%;
  text-align:left;
  cursor:pointer;
  border-radius:9px;
  font-size:13px;
  transition:
    background .16s ease,
    transform .12s ease,
    color .14s ease;
}
.menu button:hover{
  background:rgba(255,255,255,.12);
  transform:translateX(1px);
  color:#ffeaa7;
}

/* FLOATING ADD BUTTON ‚Äì NEON FAB */
.add-btn{
  position:fixed;
  bottom:26px;
  right:24px;
  width:64px;
  height:64px;
  border-radius:50%;
  border:none;
  font-size:34px;
  background:conic-gradient(from 180deg,#ff9ff3,#ffeaa7,#1dd1a1,#54a0ff,#ff9ff3);
  color:#120f24;
  cursor:pointer;
  box-shadow:
    0 26px 55px rgba(0,0,0,.95),
    0 0 0 3px rgba(255,255,255,.6);
  display:flex;
  align-items:center;
  justify-content:center;
  transition:
    transform .2s cubic-bezier(.16,.8,.3,1),
    box-shadow .2s ease,
    filter .2s ease;
}
.add-btn:hover{
  transform:translateY(-5px) scale(1.05) rotate(-3deg);
  box-shadow:
    0 34px 80px rgba(0,0,0,.98),
    0 0 0 4px rgba(255,255,255,.8);
  filter:brightness(1.05);
}
.add-btn:active{
  transform:translateY(-1px) scale(.97) rotate(-1deg);
  box-shadow:
    0 18px 38px rgba(0,0,0,.93),
    0 0 0 3px rgba(255,255,255,.7);
}

/* MODAL (EDITOR) */
.modal{
  position:fixed;
  inset:0;
  background:radial-gradient(circle at top,#3b3b98 0,rgba(2,2,10,.96) 55%);
  display:none;
  flex-direction:column;
  z-index:100;
  backdrop-filter:blur(20px);
}
.modal.active{
  display:flex;
  animation:modalIn .24s cubic-bezier(.18,.7,.32,1) forwards;
  opacity:0;
  transform:translateY(8px);
}
@keyframes modalIn{
  to{opacity:1;transform:translateY(0);}
}

/* TOPBAR */
.topbar{
  display:flex;
  align-items:center;
  padding:10px 14px;
  gap:10px;
  background:linear-gradient(135deg,#15152b,#101021);
  box-shadow:0 10px 24px rgba(0,0,0,.9);
}
.topbar button{
  background:none;
  border:none;
  color:#fff;
  font-size:22px;
  cursor:pointer;
  padding:4px 6px;
  border-radius:999px;
  transition:background .16s ease,transform .12s ease;
}
.topbar button:hover{
  background:rgba(255,255,255,.08);
  transform:translateX(-1px);
}

/* HEADING INPUT */
.heading-input{
  padding:12px;
  background:rgba(10,10,28,.98);
  border:none;
  color:#fff;
  font-size:23px;
  font-weight:700;
  border-radius:16px;
  margin:12px 12px 8px;
  outline:none;
  box-shadow:
    0 16px 30px rgba(0,0,0,.9),
    0 0 0 1px rgba(255,255,255,.09);
  backdrop-filter:blur(16px);
  transition:
    box-shadow .16s ease,
    transform .12s ease,
    background .16s ease;
}
.heading-input::placeholder{
  color:#757ab0;
}
.heading-input:focus{
  box-shadow:
    0 0 0 1px rgba(255,159,243,.85),
    0 22px 40px rgba(0,0,0,.98);
  background:radial-gradient(circle at 0 0,rgba(255,159,243,.12),rgba(12,12,34,.98));
  transform:translateY(-1px);
}

/* FORMAT TOOLBAR */
.format-toolbar{
  display:flex;
  gap:8px;
  padding:10px 12px;
  background:#141428;
  align-items:center;
  flex-wrap:wrap;
  box-shadow:0 10px 26px rgba(0,0,0,.95);
}
.format-toolbar button{
  background:#1f1f3a;
  border:none;
  color:#e5e7ff;
  padding:7px 11px;
  border-radius:999px;
  cursor:pointer;
  font-size:13px;
  font-weight:500;
  display:flex;
  align-items:center;
  gap:4px;
  transition:
    background .16s ease,
    transform .12s ease,
    box-shadow .16s ease,
    color .14s ease;
}
.format-toolbar button:hover{
  background:#2b2b4d;
  transform:translateY(-1px);
  box-shadow:0 12px 24px rgba(0,0,0,.85);
}
.format-toolbar button.active{
  background:#ff6bcb;
  color:#150c23;
  box-shadow:0 14px 30px rgba(255,107,203,.7);
}

/* FORMAT MODAL (BOTTOM SHEET) */
.format-modal{
  position:fixed;
  bottom:0;
  left:0;
  right:0;
  background:linear-gradient(180deg,#252544 0,#090913 100%);
  border-radius:26px 26px 0 0;
  padding:24px;
  max-height:70vh;
  overflow-y:auto;
  transform:translateY(100%);
  transition:transform .3s cubic-bezier(.22,.61,.36,1);
  z-index:200;
  box-shadow:0 -20px 45px rgba(0,0,0,.98);
}
.format-modal.active{
  transform:translateY(0);
}
.format-modal h3{
  margin-bottom:12px;
  font-size:13px;
  color:#b9bdf5;
  text-transform:uppercase;
  letter-spacing:.55px;
  font-weight:600;
}
.format-modal .close-btn{
  position:absolute;
  top:16px;
  right:18px;
  background:none;
  border:none;
  color:#aaa;
  font-size:28px;
  cursor:pointer;
  transition:color .2s ease,transform .15s ease;
}
.format-modal .close-btn:hover{
  color:#fff;
  transform:rotate(6deg);
}

/* FORMAT DROPDOWN */
.format-dropdown{
  position:relative;
  margin-bottom:20px;
}
.format-dropdown-btn{
  width:100%;
  background:#15152a;
  color:#fff;
  padding:14px;
  border-radius:12px;
  border:1px solid #3b3b62;
  text-align:left;
  cursor:pointer;
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-size:15px;
  transition:all .2s ease;
}
.format-dropdown-btn:hover{
  background:#202042;
  border-color:#6c63ff;
}
.format-dropdown-menu{
  position:absolute;
  top:100%;
  left:0;
  right:0;
  background:#121224;
  border-radius:12px;
  margin-top:8px;
  padding:8px;
  display:none;
  border:1px solid #34345e;
  max-height:300px;
  overflow-y:auto;
  box-shadow:0 18px 38px rgba(0,0,0,.95);
  z-index:10;
}
.format-dropdown-menu.active{display:block;}
.format-option{
  padding:12px;
  border-radius:8px;
  cursor:pointer;
  transition:background .18s ease,transform .12s ease;
  margin-bottom:4px;
}
.format-option:hover{
  background:#232347;
  transform:translateY(-1px);
}
.format-option .name{
  font-size:13px;
  color:#888;
  margin-bottom:4px;
}
.format-option .preview{
  color:#fff;
}

/* FONT / SIZE + TEXT BUTTONS ‚Äì already good, just rely on above theme */

/* COLOR PICKER (PANEL) */
.color-section{margin-bottom:20px;}
.color-grid{
  display:grid;
  grid-template-columns:repeat(8,1fr);
  gap:8px;
}
.color-box{
  width:40px;
  height:40px;
  border-radius:10px;
  cursor:pointer;
  border:2px solid transparent;
  transition:border-color .15s ease,transform .12s ease,box-shadow .15s ease;
}
.color-box:hover{
  transform:translateY(-2px) scale(1.05);
  box-shadow:0 12px 22px rgba(0,0,0,.9);
}
.color-box.selected{
  border-color:#fff;
  box-shadow:0 0 0 1px rgba(255,255,255,.6);
}

/* APPLY BUTTON */
.apply-btn-container{
  position:sticky;
  bottom:0;
  background:linear-gradient(180deg,transparent 0,#090913 32%);
  padding:16px 0 0;
  margin-top:20px;
}
.apply-btn{
  width:100%;
  background:linear-gradient(135deg,#ff6bcb,#ffeaa7);
  color:#140b21;
  border:none;
  padding:16px;
  border-radius:12px;
  font-size:16px;
  font-weight:700;
  cursor:pointer;
  transition:all .2s ease;
  box-shadow:0 14px 32px rgba(255,107,203,.75);
}
.apply-btn:hover{
  transform:translateY(-2px);
  box-shadow:0 18px 40px rgba(255,107,203,.9);
}
.apply-btn:active{
  transform:translateY(0);
  box-shadow:0 10px 22px rgba(255,107,203,.8);
}

/* EDITOR CONTENT */
.editor-content{
  flex:1;
  overflow-y:auto;
  padding:16px;
  background:#05050c;
}
#textEditor{
  min-height:300px;
  background:#14142a;
  border:none;
  color:#fff;
  font-size:16px;
  padding:16px;
  border-radius:14px;
  outline:none;
  line-height:1.6;
  box-shadow:
    inset 0 0 0 1px rgba(255,255,255,.06),
    0 18px 36px rgba(0,0,0,.96);
}
#textEditor[contenteditable="true"]{cursor:text;}

/* TODO SECTION */
.todo{
  padding:12px 16px 20px;
  background:#05050c;
}
.todo input{
  width:100%;
  padding:10px;
  border-radius:10px;
  border:none;
  background:#13132a;
  color:#fff;
  outline:none;
  box-shadow:
    inset 0 0 0 1px rgba(255,255,255,.05),
    0 12px 24px rgba(0,0,0,.9);
}
.todo input::placeholder{
  color:#7c80af;
}
.todo ul{
  list-style:none;
  margin-top:8px;
}
.todo li{
  background:#141428;
  padding:8px 12px;
  border-radius:10px;
  margin-bottom:6px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  box-shadow:
    0 12px 22px rgba(0,0,0,.95),
    0 0 0 1px rgba(255,255,255,.05);
}
.todo li button{
  background:#ff4444;
  border:none;
  color:#fff;
  padding:4px 8px;
  border-radius:6px;
  cursor:pointer;
  font-size:12px;
}

/* BIN VIEW */
.bin-view{display:none;}
.bin-view.active{display:block;}

/* SEARCH HIGHLIGHT */
mark{
  background:#ffeb3b;
  padding:0 2px;
  border-radius:3px;
}

</style>
</head>
<body>

<div class="app">
<header>
<h1>RKP Notes</h1>
<p>Let's describe your days</p>
<div id="greeting"></div>

<nav>
  <button id="notesTab">üìù Notes</button>
  <button id="binTab">üóëÔ∏è Bin</button>
  <button id="exportBtn">‚¨áÔ∏è Export</button>
  <button id="importBtn">‚¨ÜÔ∏è Import</button>
  <input type="file" id="importFile" accept=".txt" style="display:none">
</nav>

<div class="search-bar">
  <input type="text" id="searchInput" placeholder="Search notes...">
  <button id="searchBtn">Search üîç</button>
  <button id="clearSearchBtn">Clear</button>
  <span id="autosave-indicator">‚úÖ Saved</span>
</div>
</header>

<div class="notes" id="notes"></div>
<div class="bin-view" id="bin"></div>
</div>

<button class="add-btn" id="addBtn">+</button>

<!-- EDITOR -->
<div class="modal" id="editor">
  <div class="topbar">
    <button id="backBtn">‚¨ÖÔ∏è</button>
    <span>Edit Note</span>
  </div>

  <input type="text" id="heading" class="heading-input" placeholder="Note Heading...">

  <div class="format-toolbar">
    <button id="formatOnBtn" class="active">A‚úì</button>
    <button id="formatOffBtn">A√ó</button>
    <button id="formatOpenBtn">Format ‚öôÔ∏è</button>
  </div>

  <div class="editor-content">
    <div id="textEditor" contenteditable="true"></div>
  </div>

  <div class="todo">
    <input id="todoInput" placeholder="Add To-Do & press Enter">
    <ul id="todos"></ul>
  </div>
</div>

<!-- FORMAT PANEL -->
<div class="format-modal" id="formatPanel">
  <button class="close-btn" id="formatCloseBtn">√ó</button>
  
  <h3>Format</h3>
  <div class="format-dropdown">
    <div class="format-dropdown-btn" id="formatDropdownBtn">
      <span id="selectedFormat">Normal text</span>
      <span>‚ñº</span>
    </div>
    <div class="format-dropdown-menu" id="formatDropdownMenu">
      <div class="format-option" data-type="normal" data-size="16" data-weight="400">
        <div class="name">Normal text</div>
        <div class="preview" style="font-size:16px">Regular paragraph text</div>
      </div>
      <div class="format-option" data-type="title" data-size="28" data-weight="700">
        <div class="name">Title</div>
        <div class="preview" style="font-size:24px;font-weight:700">Document Title</div>
      </div>
      <div class="format-option" data-type="subtitle" data-size="20" data-weight="600">
        <div class="name">Subtitle</div>
        <div class="preview" style="font-size:18px;font-weight:600">Subtitle Text</div>
      </div>
      <div class="format-option" data-type="h1" data-size="24" data-weight="700">
        <div class="name">Heading 1</div>
        <div class="preview" style="font-size:20px;font-weight:700">Heading 1</div>
      </div>
      <div class="format-option" data-type="h2" data-size="20" data-weight="600">
        <div class="name">Heading 2</div>
        <div class="preview" style="font-size:18px;font-weight:600">Heading 2</div>
      </div>
      <div class="format-option" data-type="h3" data-size="18" data-weight="600">
        <div class="name">Heading 3</div>
        <div class="preview" style="font-size:16px;font-weight:600">Heading 3</div>
      </div>
    </div>
  </div>

  <h3>Font</h3>
  <div class="font-controls">
    <select id="fontFamily">
      <option value="system-ui">System UI</option>
      <option value="Arial">Arial</option>
      <option value="Georgia">Georgia</option>
      <option value="Times New Roman">Times New Roman</option>
      <option value="Courier New">Courier New</option>
      <option value="Verdana">Verdana</option>
    </select>
  </div>

  <h3>Size</h3>
  <div class="font-controls">
    <button id="sizeMinus">‚àí</button>
    <input type="number" id="fontSize" value="16" min="8" max="72">
    <button id="sizePlus">+</button>
  </div>

  <h3>Text Style</h3>
  <div class="format-buttons">
    <button id="boldBtn"><b>B</b></button>
    <button id="italicBtn"><i>I</i></button>
    <button id="underlineBtn"><u>U</u></button>
    <button id="strikeBtn"><s>S</s></button>
  </div>

  <h3>Text Color</h3>
  <div class="color-section">
    <div class="color-grid" id="colorGrid">
      <div class="color-box" style="background:#000" data-color="#000"></div>
      <div class="color-box" style="background:#fff" data-color="#fff"></div>
      <div class="color-box" style="background:#ff0000" data-color="#ff0000"></div>
      <div class="color-box" style="background:#ff9900" data-color="#ff9900"></div>
      <div class="color-box" style="background:#ffff00" data-color="#ffff00"></div>
      <div class="color-box" style="background:#00ff00" data-color="#00ff00"></div>
      <div class="color-box" style="background:#00ffff" data-color="#00ffff"></div>
      <div class="color-box" style="background:#0000ff" data-color="#0000ff"></div>
      <div class="color-box" style="background:#ff00ff" data-color="#ff00ff"></div>
      <div class="color-box" style="background:#808080" data-color="#808080"></div>
      <div class="color-box" style="background:#800000" data-color="#800000"></div>
      <div class="color-box" style="background:#ff6b6b" data-color="#ff6b6b"></div>
      <div class="color-box" style="background:#4ecdc4" data-color="#4ecdc4"></div>
      <div class="color-box" style="background:#45b7d1" data-color="#45b7d1"></div>
      <div class="color-box" style="background:#96ceb4" data-color="#96ceb4"></div>
      <div class="color-box" style="background:#ffeaa7" data-color="#ffeaa7"></div>
    </div>
  </div>

  <div class="apply-btn-container">
    <button class="apply-btn" id="applyBtn">Apply Changes</button>
  </div>
</div>

<script>
const KEY="ADV_NOTES_V5";
const YEAR=31536000000,TWO_MONTHS=5184000000;
let notes=JSON.parse(localStorage.getItem(KEY))||[];
let currentIndex=null;
let viewMode="notes";
let formatMode=true;
let searchKeyword="";

let currentFormat={
  fontFamily:"system-ui",
  fontSize:16,
  fontWeight:400,
  color:"#ffffff",
  bold:false,
  italic:false,
  underline:false,
  strike:false
};

const CARD_COLORS = [
  "#fff1b8", // soft yellow
  "#d9f2ff", // light blue
  "#ffd6e7", // soft pink
  "#d8f8e1", // soft green
  "#ffeaa7", // warm cream
  "#fab1a0", // peach
  "#a29bfe", // purple
  "#81ecec", // teal
  "#ff7675", // red-ish
  "#55efc4"  // mint
];

/* ASK USER NAME + GREETING */
let userName=localStorage.getItem("rkpUserName")||"";
function askUserName(){
  if(!userName){
    userName=prompt("Apna naam likho:");
    if(!userName) userName="yaar";
    localStorage.setItem("rkpUserName",userName);
  }
  const g=document.getElementById("greeting");
  g.textContent=`hello ${userName.toLowerCase()} kaise ho, aaj kuchh likhne ka plan hai ya nahi????`;
}
askUserName();

/* CLEANUP */
(function(){
 const now=Date.now();
 notes=notes.filter(n=>!n.deleted||now-n.deleted<TWO_MONTHS);
 notes=notes.filter(n=>now-(n.created||now)<YEAR);
 save();
})();

function save(){localStorage.setItem(KEY,JSON.stringify(notes))}

/* BASIC UI ELEMENTS */
const notesTab=document.getElementById("notesTab");
const binTab=document.getElementById("binTab");
const addBtn=document.getElementById("addBtn");
const editorModal=document.getElementById("editor");
const backBtn=document.getElementById("backBtn");
const headingInput=document.getElementById("heading");
const textEditor=document.getElementById("textEditor");
const notesBox=document.getElementById("notes");
const binBox=document.getElementById("bin");
const exportBtn = document.getElementById("exportBtn");
const importBtn = document.getElementById("importBtn");
const importFile = document.getElementById("importFile");
const searchInput=document.getElementById("searchInput");
const searchBtn=document.getElementById("searchBtn");
const clearSearchBtn=document.getElementById("clearSearchBtn");
const autosaveIndicator=document.getElementById("autosave-indicator");
let autosaveTimeout=null;

/* AUTOSAVE INDICATOR */
function triggerAutoSaveIndicator(){
  autosaveIndicator.textContent="‚è≥ Saving‚Ä¶";
  if(autosaveTimeout) clearTimeout(autosaveTimeout);
  autosaveTimeout=setTimeout(()=>{
    autosaveIndicator.textContent="‚úÖ Saved";
  },600);
}

/* LAST EDITED TIME HELPER */
function timeAgo(ts){
  if(!ts) return "";
  const diff=Date.now()-ts;
  const sec=Math.floor(diff/1000);
  if(sec<60) return "just now";
  const min=Math.floor(sec/60);
  if(min<60) return min+" min ago";
  const hr=Math.floor(min/60);
  if(hr<24) return hr+" hour ago";
  const day=Math.floor(hr/24);
  return day+" day ago";
}

/* SEARCH HIGHLIGHT */
function highlight(text,keyword){
  if(!keyword) return text;
  const safeKeyword=keyword.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");
  const regex=new RegExp("("+safeKeyword+")","gi");
  return text.replace(regex,"<mark>$1</mark>");
}

/* SIMPLE HTML ESCAPE */
function escapeHtml(str){
  return str.replace(/&/g,"&amp;")
            .replace(/</g,"&lt;")
            .replace(/>/g,"&gt;");
}

/* PASSWORD CHECK COMMON */
function askPasswordIfLocked(i){
  const n = notes[i];
  if(!n.locked) return true;
  const pwd = prompt("This note is locked. Enter password:");
  if(pwd === n.password){
    return true;
  } else {
    alert("Wrong password!");
    return false;
  }
}

/* TABS */
notesTab.onclick=()=>{viewMode="notes";notesBox.style.display="grid";binBox.classList.remove("active");renderNotes();};
binTab.onclick=()=>{viewMode="bin";notesBox.style.display="none";binBox.classList.add("active");renderBin();};

/* RENDER NOTES */
function renderNotes(){
 notesBox.innerHTML="";
 const active=notes
   .filter(n=>!n.deleted)
   .sort((a,b)=> (b.pinned?-1:0) - (a.pinned?-1:0));

 active.forEach(n=>{
  const idx=notes.indexOf(n);
  const card=document.createElement("div");
  card.className=`note ${n.pinned?"pinned":""}`;

  const bg = n.color || "#fff1b8";
  card.style.background = bg;

  card.onclick=e=>{
    if(!e.target.closest(".menu-btn") && !e.target.closest(".menu")){
      openEditor(idx);
    }
  };

  if(n.heading){
    const h=document.createElement("h3");
    h.innerHTML=highlight(escapeHtml(n.heading),searchKeyword);
    card.appendChild(h);
  }

  const p=document.createElement("p");
  if(n.locked){
    p.innerText = "üîí This note is locked. Unlock to view content.";
  } else {
    let plain="";
    if(n.content){
      const temp=document.createElement("div");
      temp.innerHTML=n.content;
      plain=(temp.textContent||"").slice(0,150);
    } else {
      plain="Empty note";
    }
    p.innerHTML=highlight(escapeHtml(plain+(plain.length===150?"...":"")),searchKeyword);
  }
  card.appendChild(p);

  const meta=document.createElement("div");
  meta.className="note-meta";
  const lockedLabel=n.locked?"üîí Locked":"üîì Unlocked";
  meta.innerHTML=`<span>${lockedLabel}</span><span>Last edited: ${timeAgo(n.lastEdited||n.created)}</span>`;
  card.appendChild(meta);

  const menuBtn=document.createElement("div");
  menuBtn.className="menu-btn";
  menuBtn.innerText="‚ãÆ";
  menuBtn.onclick=ev=>{
    ev.stopPropagation();
    toggleMenu(idx,menuBtn);
  };

  const menu=document.createElement("div");
  menu.className="menu";
  menu.innerHTML=`
    <button onclick="event.stopPropagation();togglePinProtected(${idx});closeMenus()">üìå ${n.pinned?"Unpin":"Pin"}</button>
    <button onclick="event.stopPropagation();openColorPicker(${idx});closeMenus()">üé® Change color</button>
    <button onclick="event.stopPropagation();toggleLock(${idx});closeMenus()">${n.locked?"üîì Unlock":"üîí Lock"}</button>
    <button onclick="event.stopPropagation();softDeleteProtected(${idx});closeMenus()">üóëÔ∏è Delete</button>
  `;
  card.appendChild(menuBtn);
  card.appendChild(menu);

  notesBox.appendChild(card);
 });
}

/* BIN RENDER */
function renderBin(){
 binBox.innerHTML="<h2 style='margin-bottom:16px'>üóëÔ∏è Deleted Notes</h2>";
 const deleted=notes.filter(n=>n.deleted);
 if(!deleted.length){
  binBox.innerHTML+="<p style='color:#aaa'>Bin is empty</p>";
  return;
 }
 deleted.forEach(n=>{
  const idx=notes.indexOf(n);
  const card=document.createElement("div");
  card.className=`note`;
  card.style.marginBottom="12px";
  card.style.background = n.color || "#fff1b8";

  if(n.heading){
    const h=document.createElement("h3");
    h.innerText=n.heading;
    card.appendChild(h);
  }
  if(n.locked){
    const p=document.createElement("p");
    p.innerText="üîí Locked note (content hidden)";
    card.appendChild(p);
  } else if(n.content){
    const temp=document.createElement("div");
    temp.innerHTML=n.content;
    const txt=(temp.textContent||"").slice(0,150);
    const p=document.createElement("p");
    p.innerText=txt+(txt.length===150?"...":"");
    card.appendChild(p);
  }
  const actions=document.createElement("div");
  actions.style.marginTop="10px";
  actions.innerHTML=`
    <button style="background:#4CAF50;color:#fff;border:none;padding:6px 12px;border-radius:6px;margin-right:8px;cursor:pointer" onclick="restoreProtected(${idx})">‚ôªÔ∏è Restore</button>
    <button style="background:#f44336;color:#fff;border:none;padding:6px 12px;border-radius:6px;cursor:pointer" onclick="deleteForeverProtected(${idx})">üóëÔ∏è Delete Forever</button>
  `;
  card.appendChild(actions);
  binBox.appendChild(card);
 });
}

/* MENU HELPERS */
function toggleMenu(i,btn){
 const menu=btn.nextElementSibling;
 const visible=menu.style.display==="block";
 closeMenus();
 if(!visible) menu.style.display="block";
}
function closeMenus(){
 document.querySelectorAll(".menu").forEach(m=>m.style.display="none");
}
document.addEventListener("click",e=>{
 if(!e.target.closest(".menu") && !e.target.closest(".menu-btn")) closeMenus();
});

/* CRUD */
addBtn.onclick=function(){
 notes.push({
  heading:"",
  content:"",
  todos:[],
  color:CARD_COLORS[Math.floor(Math.random()*CARD_COLORS.length)],
  pinned:false,
  created:Date.now(),
  lastEdited:Date.now(),
  locked:false,
  password:""
 });
 save();
 openEditor(notes.length-1);
};

function openEditor(i){
 currentIndex=i;
 const n=notes[i];

 if(n.locked){
   const pwd=prompt("Enter password to unlock this note:");
   if(pwd!==n.password){
     alert("Wrong password!");
     return;
   }
 }

 headingInput.value=n.heading||"";
 textEditor.innerHTML=n.content||"";
 document.getElementById("todos").innerHTML="";
 (n.todos||[]).forEach(t=>addTodoItem(t));
 editorModal.classList.add("active");
 formatMode=true;
 updateFormatButtons();
}

backBtn.onclick=function(){
 if(currentIndex!==null){
  const n=notes[currentIndex];
  n.heading=headingInput.value.trim();
  n.content=textEditor.innerHTML;
  const todosUl=document.getElementById("todos");
  n.todos=[...todosUl.children].map(li=>li.firstChild.textContent);
  n.lastEdited=Date.now();
  save();
 }
 editorModal.classList.remove("active");
 autosaveIndicator.textContent="‚úÖ Saved";
 if(viewMode==="bin") renderBin(); else renderNotes();
};

function togglePin(i){
 notes[i].pinned=!notes[i].pinned;
 notes[i].lastEdited=Date.now();
 save();renderNotes();
}
function softDelete(i){
 notes[i].deleted=Date.now();
 notes[i].lastEdited=Date.now();
 save();renderNotes();
}
function restoreNote(i){
 delete notes[i].deleted;
 notes[i].lastEdited=Date.now();
 save();renderBin();
}
function deleteForever(i){
 if(confirm("Delete permanently?")){
  notes.splice(i,1);
  save();renderBin();
 }
}

/* PROTECTED WRAPPERS */
function togglePinProtected(i){
  if(!askPasswordIfLocked(i)) return;
  togglePin(i);
}
function softDeleteProtected(i){
  if(!askPasswordIfLocked(i)) return;
  softDelete(i);
}
function restoreProtected(i){
  if(!askPasswordIfLocked(i)) return;
  restoreNote(i);
}
function deleteForeverProtected(i){
  if(!askPasswordIfLocked(i)) return;
  deleteForever(i);
}

/* CHANGE COLOR POPUP */
function openColorPicker(i){
  const n = notes[i];

  const popup = document.createElement("div");
  popup.style.position = "fixed";
  popup.style.left = "50%";
  popup.style.top = "50%";
  popup.style.transform = "translate(-50%, -50%)";
  popup.style.background = "#1e1e1e";
  popup.style.padding = "16px";
  popup.style.borderRadius = "12px";
  popup.style.boxShadow = "0 4px 24px rgba(0,0,0,0.6)";
  popup.style.zIndex = "9999";
  popup.style.maxWidth = "320px";

  const title = document.createElement("div");
  title.innerText = "Select card color";
  title.style.marginBottom = "10px";
  title.style.fontSize = "14px";
  title.style.color = "#fff";
  popup.appendChild(title);

  const grid = document.createElement("div");
  grid.style.display = "grid";
  grid.style.gridTemplateColumns = "repeat(5, 1fr)";
  grid.style.gap = "8px";

  CARD_COLORS.forEach(col => {
    const box = document.createElement("div");
    box.style.width = "40px";
    box.style.height = "40px";
    box.style.borderRadius = "10px";
    box.style.cursor = "pointer";
    box.style.border = "2px solid transparent";
    box.style.background = col;
    if(n.color === col){
      box.style.borderColor = "#fff";
    }
    box.onclick = () => {
      n.color = col;
      n.lastEdited = Date.now();
      save();
      document.body.removeChild(popup);
      renderNotes();
    };
    grid.appendChild(box);
  });

  popup.appendChild(grid);

  const closeBtn = document.createElement("button");
  closeBtn.innerText = "Close";
  closeBtn.style.marginTop = "12px";
  closeBtn.style.width = "100%";
  closeBtn.style.background = "#333";
  closeBtn.style.color = "#fff";
  closeBtn.style.border = "none";
  closeBtn.style.padding = "8px 0";
  closeBtn.style.borderRadius = "8px";
  closeBtn.style.cursor = "pointer";
  closeBtn.onclick = () => {
    document.body.removeChild(popup);
  };
  popup.appendChild(closeBtn);

  document.body.appendChild(popup);
}

/* LOCK / UNLOCK */
function toggleLock(i){
 const n=notes[i];
 if(!n.locked){
   const pwd=prompt("Set password (digits/words/mixed allowed):");
   if(!pwd){
     alert("Password empty nahi ho sakta");
     return;
   }
   n.password=pwd;
   n.locked=true;
   alert("Note locked.");
 }else{
   const pwd=prompt("Enter password to unlock:");
   if(pwd===n.password){
     n.locked=false;
     alert("Note unlocked.");
   }else{
     alert("Wrong password!");
   }
 }
 n.lastEdited=Date.now();
 save();
 renderNotes();
}

/* TODO */
const todoInput=document.getElementById("todoInput");
todoInput.onkeydown=e=>{
 if(e.key==="Enter" && e.target.value.trim()){
  addTodoItem(e.target.value.trim());
  e.target.value="";
 }
};
function addTodoItem(text){
 const li=document.createElement("li");
 const span=document.createElement("span");
 span.innerText=text;
 const btn=document.createElement("button");
 btn.innerText="√ó";
 btn.onclick=()=>li.remove();
 li.appendChild(span);
 li.appendChild(btn);
 document.getElementById("todos").appendChild(li);
}

/* FORMAT MODE */
const formatOnBtn=document.getElementById("formatOnBtn");
const formatOffBtn=document.getElementById("formatOffBtn");

function updateFormatButtons(){
 formatOnBtn.classList.toggle("active",formatMode);
 formatOffBtn.classList.toggle("active",!formatMode);
}
formatOnBtn.onclick=()=>{formatMode=true;updateFormatButtons();};
formatOffBtn.onclick=()=>{formatMode=false;updateFormatButtons();};

/* FORMAT PANEL UI */
const formatPanel=document.getElementById("formatPanel");
document.getElementById("formatOpenBtn").onclick=()=>formatPanel.classList.add("active");
document.getElementById("formatCloseBtn").onclick=()=>formatPanel.classList.remove("active");

const formatDropdownBtn=document.getElementById("formatDropdownBtn");
const formatDropdownMenu=document.getElementById("formatDropdownMenu");
formatDropdownBtn.onclick=()=>formatDropdownMenu.classList.toggle("active");

formatDropdownMenu.querySelectorAll(".format-option").forEach(opt=>{
 opt.onclick=()=>{
  const type=opt.dataset.type;
  const size=parseInt(opt.dataset.size,10);
  const weight=parseInt(opt.dataset.weight,10);
  document.getElementById("selectedFormat").innerText=opt.querySelector(".name").innerText;
  currentFormat.fontSize=size;
  currentFormat.fontWeight=weight;
  document.getElementById("fontSize").value=size;
  formatDropdownMenu.classList.remove("active");
 };
});

document.getElementById("fontFamily").onchange=e=>{
 currentFormat.fontFamily=e.target.value;
};
document.getElementById("sizeMinus").onclick=()=>{
 const fs=document.getElementById("fontSize");
 fs.value=Math.max(8,parseInt(fs.value,10)-2);
 currentFormat.fontSize=parseInt(fs.value,10);
};
document.getElementById("sizePlus").onclick=()=>{
 const fs=document.getElementById("fontSize");
 fs.value=Math.min(72,parseInt(fs.value,10)+2);
 currentFormat.fontSize=parseInt(fs.value,10);
};

function toggleStyleBtn(id,key){
 const btn=document.getElementById(id);
 btn.onclick=()=>{
  currentFormat[key]=!currentFormat[key];
  btn.classList.toggle("active",currentFormat[key]);
 };
}
toggleStyleBtn("boldBtn","bold");
toggleStyleBtn("italicBtn","italic");
toggleStyleBtn("underlineBtn","underline");
toggleStyleBtn("strikeBtn","strike");

document.getElementById("colorGrid").onclick=e=>{
 const box=e.target.closest(".color-box");
 if(!box) return;
 const color=box.dataset.color;
 currentFormat.color=color;
 document.querySelectorAll(".color-box").forEach(b=>b.classList.remove("selected"));
 box.classList.add("selected");
};

document.getElementById("applyBtn").onclick=()=>{
 formatPanel.classList.remove("active");
};

/* TYPE LISTENER + AUTOSAVE INDICATOR */
textEditor.addEventListener("input",e=>{
 triggerAutoSaveIndicator();
 if(!formatMode) return;   // A√ó me kuch nahi
 const sel=window.getSelection();
 if(!sel.rangeCount) return;
 const range=sel.getRangeAt(0);
 const node=range.startContainer;
 if(node.nodeType!==Node.TEXT_NODE) return;

 const span=document.createElement("span");
 span.textContent=node.textContent;

 span.style.fontFamily=currentFormat.fontFamily;
 span.style.fontSize=currentFormat.fontSize+"px";
 span.style.color=currentFormat.color;
 span.style.fontWeight=currentFormat.bold? "700": currentFormat.fontWeight;
 span.style.fontStyle=currentFormat.italic? "italic":"normal";

 let deco="";
 if(currentFormat.underline) deco+="underline ";
 if(currentFormat.strike) deco+="line-through ";
 span.style.textDecoration=deco.trim();

 node.parentNode.replaceChild(span,node);

 const newRange=document.createRange();
 newRange.setStart(span,span.childNodes.length);
 newRange.collapse(true);
 sel.removeAllRanges();
 sel.addRange(newRange);
});

/* SEARCH EVENTS */
function doSearch(){
  searchKeyword=searchInput.value.trim();
  renderNotes();
}
function clearSearch(){
  searchKeyword="";
  searchInput.value="";
  renderNotes();
}
searchBtn.onclick=doSearch;
clearSearchBtn.onclick=clearSearch;
searchInput.addEventListener("keydown",e=>{
  if(e.key==="Enter") doSearch();
});

/* EXPORT NOTES -> TXT (UTF-8 JSON) + REDIRECT */
exportBtn.onclick = () => {
  try {
    const payload = {
      version: 1,
      exportedAt: new Date().toISOString(),
      notes
    };
    const text = JSON.stringify(payload, null, 2);

    const blob = new Blob([text], { type: "text/plain;charset=utf-8" });
    const url = URL.createObjectURL(blob);

    const a = document.createElement("a");
    a.href = url;
    a.download = "advanced-notes-backup.txt";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);

    setTimeout(() => {
      redirectToDrive();
    }, 800);
  } catch (err) {
    alert("Export failed: " + err.message);
  }
};

/* DEVICE DETECTION + REDIRECT */
function redirectToDrive() {
  const ua = navigator.userAgent || navigator.vendor || window.opera;
  const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(ua);

  if (isMobile) {
    window.location.href = "intent://drive.google.com/#Intent;scheme=https;package=com.google.android.apps.docs;end;";
  } else {
    window.location.href = "https://drive.google.com/";
  }
}

/* IMPORT NOTES FROM TXT (UTF-8 JSON) */
importBtn.onclick = () => {
  importFile.click();
};

importFile.onchange = (event) => {
  const file = event.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = (e) => {
    try {
      const content = e.target.result;
      const data = JSON.parse(content);

      if (!data || !Array.isArray(data.notes)) {
        alert("Invalid backup file.");
        return;
      }

      notes = data.notes;
      save();
      viewMode = "notes";
      notesBox.style.display = "grid";
      binBox.classList.remove("active");
      renderNotes();
      alert("Notes imported successfully!");
    } catch (err) {
      alert("Import failed: " + err.message);
    } finally {
      importFile.value = "";
    }
  };
  reader.onerror = () => {
    alert("Error reading file.");
  };
  reader.readAsText(file, "utf-8");
};

renderNotes();
</script>
</body>
</html>
